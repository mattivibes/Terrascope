<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Terrascope - Earth Monitoring Platform</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script><!-- Google Identity Services -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <style>
        body {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: radial-gradient(ellipse at center, #0f1419 0%, #000000 100%);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Animated Space Background */
        .space-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        /* Twinkling Stars */
        .stars {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s infinite;
        }

        .star:nth-child(odd) {
            animation-delay: 1s;
        }

        .star:nth-child(3n) {
            animation-delay: 2s;
        }

        /* Floating Earth Particles */
        .earth-particles {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .earth-particle {
            position: absolute;
            opacity: 0.6;
            animation: float 20s infinite linear;
        }

        /* Nebula Effect */
        .nebula {
            position: absolute;
            width: 300px;
            height: 300px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(116, 185, 255, 0.1) 0%, transparent 70%);
            animation: nebulaDrift 30s infinite linear;
        }

        .nebula:nth-child(2) {
            background: radial-gradient(circle, rgba(45, 213, 115, 0.08) 0%, transparent 70%);
            animation-delay: -10s;
            animation-duration: 40s;
        }

        .nebula:nth-child(3) {
            background: radial-gradient(circle, rgba(255, 165, 2, 0.06) 0%, transparent 70%);
            animation-delay: -20s;
            animation-duration: 35s;
        }

        /* Shooting Stars */
        .shooting-star {
            position: absolute;
            width: 2px;
            height: 2px;
            background: linear-gradient(45deg, #fff, transparent);
            border-radius: 50%;
            animation: shoot 3s infinite;
        }

        .shooting-star::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 50px;
            height: 1px;
            background: linear-gradient(90deg, #fff, transparent);
            transform: translateX(-50px);
        }

        /* Floating Earth Globe */
        .earth-globe {
            position: absolute;
            top: 20%;
            right: 10%;
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4a90e2 0%, #2e7d32 50%, #1565c0 100%);
            animation: earthRotate 20s infinite linear;
            box-shadow: 
                inset -20px -20px 50px rgba(0,0,0,0.5),
                0 0 50px rgba(74, 144, 226, 0.3);
            opacity: 0.8;
        }

        .earth-globe::before {
            content: '';
            position: absolute;
            top: 20%;
            left: 30%;
            width: 30%;
            height: 40%;
            background: #2e7d32;
            border-radius: 50% 20% 40% 30%;
            opacity: 0.8;
        }

        .earth-globe::after {
            content: '';
            position: absolute;
            top: 60%;
            left: 10%;
            width: 25%;
            height: 30%;
            background: #2e7d32;
            border-radius: 40% 60% 30% 50%;
            opacity: 0.7;
        }

        /* Space Animations */
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        @keyframes float {
            0% { transform: translateY(100vh) translateX(-50px) rotate(0deg); }
            100% { transform: translateY(-100px) translateX(50px) rotate(360deg); }
        }

        @keyframes nebulaDrift {
            0% { transform: translateX(-300px) translateY(100vh); }
            100% { transform: translateX(100vw) translateY(-300px); }
        }

        @keyframes shoot {
            0% { 
                transform: translateX(-100px) translateY(100px);
                opacity: 0;
            }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { 
                transform: translateX(300px) translateY(-100px);
                opacity: 0;
            }
        }

        @keyframes earthRotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        /* Navigation */
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            margin-bottom: 40px;
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .logo {
            font-size: 2rem;
            font-weight: bold;
            color: white;
            display: flex;
            align-items: center;
            gap: 15px;
            text-decoration: none;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(116, 185, 255, 0.3);
            position: relative;
            overflow: hidden;
        }

        .logo-icon::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: logoShine 3s infinite;
        }

        .logo-text {
            background: linear-gradient(135deg, #74b9ff, #ffffff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-family: 'Segoe UI', sans-serif;
            letter-spacing: -1px;
        }

        .nav-links {
            display: flex;
            gap: 20px;
        }

        .nav-link {
            color: white;
            text-decoration: none;
            padding: 10px 20px;
            border-radius: 25px;
            transition: all 0.3s;
            opacity: 0.8;
            backdrop-filter: blur(5px);
        }

        .nav-link:hover {
            background: rgba(255,255,255,0.2);
            opacity: 1;
            transform: translateY(-2px);
        }

        .auth-buttons {
            display: flex;
            gap: 10px;
        }

        .auth-btn {
            padding: 10px 20px;
            border: 2px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.1);
            color: white;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
        }

        .auth-btn:hover {
            background: rgba(255,255,255,0.2);
            border-color: rgba(255,255,255,0.5);
            transform: translateY(-2px);
        }

        .auth-btn.primary {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            border-color: transparent;
        }

        .auth-btn.primary:hover {
            background: linear-gradient(135deg, #0984e3, #74b9ff);
            box-shadow: 0 5px 15px rgba(116, 185, 255, 0.4);
        }

        /* Authentication Modal */
        .auth-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            animation: fadeIn 0.3s ease-out;
            backdrop-filter: blur(5px);
        }

        .auth-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .auth-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 40px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: slideUp 0.3s ease-out;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .auth-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .auth-title {
            font-size: 2rem;
            color: #333;
            margin: 0 0 10px 0;
        }

        .auth-subtitle {
            color: #666;
            margin: 0;
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-label {
            font-weight: 600;
            color: #333;
            font-size: 0.9rem;
        }

        .form-input {
            padding: 15px;
            border: 2px solid #e1e8ed;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s;
            background: rgba(255, 255, 255, 0.9);
        }

        .form-input:focus {
            outline: none;
            border-color: #74b9ff;
            box-shadow: 0 0 0 3px rgba(116, 185, 255, 0.1);
        }

        .form-submit {
            padding: 15px;
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .form-submit:hover {
            background: linear-gradient(135deg, #0984e3, #74b9ff);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(116, 185, 255, 0.4);
        }

        .auth-switch {
            text-align: center;
            margin-top: 20px;
            color: #666;
        }

        .auth-switch a {
            color: #74b9ff;
            text-decoration: none;
            font-weight: 600;
        }

        .auth-switch a:hover {
            text-decoration: underline;
        }

        /* Google Auth Styles */
        .google-auth-section {
            margin-bottom: 20px;
        }

        .google-btn {
            width: 100%;
            padding: 15px;
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid #e1e8ed;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #333;
            margin-bottom: 20px;
        }

        .google-btn:hover {
            border-color: #4285F4;
            box-shadow: 0 2px 8px rgba(66, 133, 244, 0.2);
            transform: translateY(-1px);
        }

        .google-btn:active {
            transform: translateY(0);
        }

        .divider {
            position: relative;
            text-align: center;
            margin: 20px 0;
        }

        .divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: #e1e8ed;
        }

        .divider span {
            background: rgba(255, 255, 255, 0.95);
            padding: 0 15px;
            color: #666;
            font-size: 0.9rem;
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
        }

        .close-modal:hover {
            background: #f1f3f4;
            color: #333;
        }

        .user-menu {
            position: relative;
            display: none;
        }

        .user-menu.active {
            display: block;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .user-avatar:hover {
            transform: scale(1.1);
        }

        .user-dropdown {
            position: absolute;
            top: 50px;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            padding: 10px 0;
            min-width: 150px;
            display: none;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .user-dropdown.active {
            display: block;
        }

        .dropdown-item {
            padding: 12px 20px;
            color: #333;
            text-decoration: none;
            display: block;
            transition: background 0.3s;
        }

        .dropdown-item:hover {
            background: rgba(116, 185, 255, 0.1);
        }

        /* Map Styles */
        .leaflet-map {
            height: 400px;
            border-radius: 15px;
            overflow: hidden;
        }

        /* Launch Page */
        .launch-page {
            text-align: center;
            color: white;
            animation: fadeIn 1s ease-in;
        }

        .hero-section {
            margin-bottom: 60px;
        }

        .hero-title {
            font-size: 4rem;
            margin: 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 20px;
            background: linear-gradient(135deg, #74b9ff, #ffffff, #74b9ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: titleGlow 3s ease-in-out infinite alternate;
        }

        .hero-subtitle {
            font-size: 1.5rem;
            opacity: 0.9;
            margin-bottom: 40px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 50px;
        }

        .option-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 40px 30px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .option-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s;
        }

        .option-card:hover::before {
            left: 100%;
        }

        .option-card:hover {
            transform: translateY(-10px);
            background: rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            border-color: rgba(116, 185, 255, 0.5);
        }

        .option-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            display: block;
            filter: drop-shadow(0 0 10px rgba(255,255,255,0.3));
        }

        .option-title {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: white;
        }

        .option-description {
            font-size: 1.1rem;
            opacity: 0.9;
            line-height: 1.6;
            color: white;
        }

        /* Content Pages */
        .content-page {
            display: none;
            animation: slideIn 0.5s ease-out;
        }

        .content-page.active {
            display: block;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .page-title {
            font-size: 2.5rem;
            color: white;
            margin: 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .back-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.3);
        }

        .back-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        .content-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .content-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .section-title {
            font-size: 1.8rem;
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Weather specific styles */
        .weather-card {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .weather-main {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .temperature {
            font-size: 3rem;
            font-weight: bold;
        }

        .weather-icon {
            font-size: 4rem;
            filter: drop-shadow(0 0 10px rgba(255,255,255,0.3));
        }

        .weather-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .weather-item {
            background: rgba(255,255,255,0.2);
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            backdrop-filter: blur(5px);
        }

        .location-input {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .location-input input {
            flex: 1;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            background: rgba(255,255,255,0.9);
        }

        .btn {
            padding: 12px 20px;
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .btn:hover {
            background: linear-gradient(135deg, #0984e3, #74b9ff);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(116, 185, 255, 0.4);
        }

        /* Professional Disaster Dashboard Styles */
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 32px;
            padding: 24px 32px;
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            border: 1px solid rgba(148, 163, 184, 0.2);
        }

        .header-left {
            flex: 1;
        }

        .dashboard-title {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 2rem;
            font-weight: 800;
            color: white;
            margin: 0 0 8px 0;
            letter-spacing: -1px;
        }

        .title-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #ef4444, #dc2626);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            box-shadow: 0 8px 32px rgba(239, 68, 68, 0.3);
        }

        .dashboard-subtitle {
            color: #94a3b8;
            font-size: 1rem;
            margin: 0;
            font-weight: 400;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .live-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 20px;
            color: #22c55e;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .live-indicator {
            width: 8px;
            height: 8px;
            background: #22c55e;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .refresh-btn, .back-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 8px;
            color: #3b82f6;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .refresh-btn:hover, .back-btn:hover {
            background: rgba(59, 130, 246, 0.2);
            border-color: rgba(59, 130, 246, 0.5);
        }

        .search-filter-section {
            margin-bottom: 32px;
            padding: 24px 32px;
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            border: 1px solid rgba(148, 163, 184, 0.2);
        }

        .search-container {
            margin-bottom: 24px;
        }

        .search-input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
            max-width: 600px;
        }

        .search-icon {
            position: absolute;
            left: 16px;
            color: #64748b;
            z-index: 1;
        }

        .search-input {
            flex: 1;
            padding: 12px 16px 12px 48px;
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid rgba(148, 163, 184, 0.3);
            border-radius: 8px 0 0 8px;
            color: white;
            font-size: 0.875rem;
            outline: none;
            transition: all 0.2s;
        }

        .search-input:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .search-input::placeholder {
            color: #64748b;
        }

        .search-btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, #3b82f6, #1e40af);
            border: none;
            border-radius: 0 8px 8px 0;
            color: white;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .search-btn:hover {
            background: linear-gradient(135deg, #1e40af, #1e3a8a);
        }

        .filter-section {
            display: flex;
            gap: 32px;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .filter-label {
            color: #cbd5e1;
            font-size: 0.875rem;
            font-weight: 500;
            white-space: nowrap;
        }

        .filter-select {
            padding: 8px 12px;
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid rgba(148, 163, 184, 0.3);
            border-radius: 6px;
            color: white;
            font-size: 0.875rem;
            outline: none;
            cursor: pointer;
        }

        .disaster-type-filters {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .type-filter {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(148, 163, 184, 0.3);
            border-radius: 20px;
            color: #cbd5e1;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .type-filter:hover {
            background: rgba(30, 41, 59, 0.8);
            border-color: rgba(148, 163, 184, 0.5);
        }

        .type-filter.active {
            background: linear-gradient(135deg, #3b82f6, #1e40af);
            border-color: #3b82f6;
            color: white;
        }

        .filter-icon {
            font-size: 1rem;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 24px;
            min-height: 600px;
        }

        .stats-section {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .stat-card {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 20px;
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 12px;
            border: 1px solid rgba(148, 163, 184, 0.2);
            transition: all 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .earthquake-stat { background: linear-gradient(135deg, #ef4444, #dc2626); }
        .hurricane-stat { background: linear-gradient(135deg, #3b82f6, #1e40af); }
        .flood-stat { background: linear-gradient(135deg, #06b6d4, #0891b2); }
        .fire-stat { background: linear-gradient(135deg, #f97316, #ea580c); }

        .stat-content {
            flex: 1;
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
            line-height: 1;
        }

        .stat-label {
            color: #94a3b8;
            font-size: 0.875rem;
            margin-top: 4px;
        }

        .map-section {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            border: 1px solid rgba(148, 163, 184, 0.2);
            overflow: hidden;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid rgba(148, 163, 184, 0.2);
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.125rem;
            font-weight: 600;
            color: white;
            margin: 0;
        }

        .map-controls {
            display: flex;
            gap: 8px;
        }

        .map-control-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 6px;
            color: #3b82f6;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .map-control-btn:hover {
            background: rgba(59, 130, 246, 0.2);
        }

        .map-container {
            position: relative;
            height: 400px;
        }

        .disaster-map {
            width: 100%;
            height: 100%;
            background: #1e293b;
        }

        .map-legend {
            position: absolute;
            bottom: 16px;
            left: 16px;
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 8px;
            padding: 12px;
            border: 1px solid rgba(148, 163, 184, 0.2);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
            color: #cbd5e1;
            font-size: 0.75rem;
        }

        .legend-item:last-child {
            margin-bottom: 0;
        }

        .legend-marker {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .earthquake-marker { background: #ef4444; }
        .hurricane-marker { background: #3b82f6; }
        .flood-marker { background: #06b6d4; }
        .fire-marker { background: #f97316; }

        .events-section {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            border: 1px solid rgba(148, 163, 184, 0.2);
            overflow: hidden;
        }

        .events-count {
            color: #64748b;
            font-size: 0.875rem;
        }

        .disaster-tabs {
            display: flex;
            gap: 4px;
            padding: 0 24px;
            margin-bottom: 16px;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .disaster-tabs::-webkit-scrollbar {
            display: none;
        }

        .disaster-tab {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(148, 163, 184, 0.3);
            border-radius: 6px;
            color: #cbd5e1;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
            min-width: fit-content;
        }

        .disaster-tab:hover {
            background: rgba(30, 41, 59, 0.8);
            border-color: rgba(148, 163, 184, 0.5);
        }

        .disaster-tab.active {
            background: linear-gradient(135deg, #3b82f6, #1e40af);
            border-color: #3b82f6;
            color: white;
        }

        .tab-icon {
            font-size: 1rem;
        }

        .tab-label {
            font-weight: 500;
        }

        .tab-count {
            background: rgba(255, 255, 255, 0.2);
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.75rem;
            font-weight: 600;
            min-width: 20px;
            text-align: center;
        }

        .disaster-tab.active .tab-count {
            background: rgba(255, 255, 255, 0.3);
        }

        .events-list {
            height: 320px;
            overflow-y: auto;
            padding: 0 24px 24px;
        }

        .loading-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 200px;
            color: #64748b;
        }

        .loading-spinner {
            width: 32px;
            height: 32px;
            border: 3px solid rgba(59, 130, 246, 0.3);
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 16px;
        }

        .disaster-event {
            padding: 16px;
            margin-bottom: 12px;
            background: rgba(30, 41, 59, 0.6);
            border-radius: 8px;
            border-left: 4px solid;
            cursor: pointer;
            transition: all 0.2s;
        }

        .disaster-event:hover {
            background: rgba(30, 41, 59, 0.8);
            transform: translateX(4px);
        }

        .disaster-event.selected {
            background: rgba(59, 130, 246, 0.1);
            border-left-color: #3b82f6;
        }

        .disaster-event.earthquake { border-left-color: #ef4444; }
        .disaster-event.hurricane { border-left-color: #3b82f6; }
        .disaster-event.flood { border-left-color: #06b6d4; }
        .disaster-event.wildfire { border-left-color: #f97316; }

        .event-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }

        .event-title {
            font-weight: 600;
            color: white;
            font-size: 0.875rem;
            line-height: 1.4;
        }

        .event-severity {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .severity-high {
            background: rgba(239, 68, 68, 0.2);
            color: #fca5a5;
        }

        .severity-medium {
            background: rgba(245, 158, 11, 0.2);
            color: #fcd34d;
        }

        .severity-low {
            background: rgba(34, 197, 94, 0.2);
            color: #86efac;
        }

        .event-details {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .event-location, .event-date, .event-magnitude {
            color: #94a3b8;
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        @media (max-width: 1200px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .stats-section {
                flex-direction: row;
                overflow-x: auto;
            }
            
            .stat-card {
                min-width: 200px;
            }
        }

        /* Map Styles */
        .map-container {
            position: relative;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .world-map {
            width: 100%;
            height: 300px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
        }

        .map-legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: white;
            font-size: 0.9rem;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .earthquake-color { background: #ff4757; }
        .hurricane-color { background: #3742fa; }
        .flood-color { background: #2ed573; }
        .fire-color { background: #ffa502; }

        .map-stats {
            background: rgba(248, 249, 250, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            padding: 15px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .stat-row {
            display: flex;
            justify-content: space-around;
            gap: 10px;
        }

        .mini-stat {
            text-align: center;
        }

        .mini-stat .stat-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
        }

        .mini-stat .stat-label {
            font-size: 0.8rem;
            color: #666;
        }

        .disaster-marker {
            cursor: pointer;
            transition: all 0.3s;
        }

        .disaster-marker:hover {
            transform: scale(1.2);
        }

        .pulse-ring {
            animation: pulse 2s infinite;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(30px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes pulse {
            0% {
                r: 5;
                opacity: 1;
            }
            50% {
                r: 15;
                opacity: 0.5;
            }
            100% {
                r: 25;
                opacity: 0;
            }
        }

        @keyframes logoShine {
            0% {
                transform: translateX(-100%) translateY(-100%) rotate(45deg);
            }
            50% {
                transform: translateX(100%) translateY(100%) rotate(45deg);
            }
            100% {
                transform: translateX(100%) translateY(100%) rotate(45deg);
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes titleGlow {
            0% { text-shadow: 0 0 20px rgba(116, 185, 255, 0.5); }
            100% { text-shadow: 0 0 30px rgba(116, 185, 255, 0.8), 0 0 40px rgba(116, 185, 255, 0.3); }
        }

        @keyframes promptSlideIn {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        @keyframes promptSlideOut {
            from {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
            to {
                opacity: 0;
                transform: translateX(-50%) translateY(-10px);
            }
        }

        /* Cities Grid Styles */
        .cities-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .city-card {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(116, 185, 255, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .city-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(116, 185, 255, 0.4);
        }

        .city-name {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .city-weather {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 8px;
        }

        .city-temp {
            font-size: 1.8rem;
            font-weight: bold;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .hero-title {
                font-size: 2.5rem;
            }
            
            .options-grid {
                grid-template-columns: 1fr;
            }
            
            .content-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-links {
                display: none;
            }
            
            .page-header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }

            .cities-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 15px;
            }

            .earth-globe {
                width: 100px;
                height: 100px;
                top: 10%;
                right: 5%;
            }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body><!-- Professional Space Background -->
  <div class="space-background"><!-- Professional Stars -->
   <div class="stars" id="stars"></div><!-- Sun Rays Effect -->
   <div class="sun-rays"></div><!-- Realistic Earth View -->
   <div class="earth-view"></div><!-- Atmospheric Glow -->
   <div class="atmosphere"></div>
  </div>
  <div class="container"><!-- Navigation -->
   <nav class="navbar"><a href="#" class="logo" onclick="showLaunchPage()">
     <div class="logo-icon">
      <svg width="28" height="28" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10" /> <path d="M12 6v6l4 2" /> <path d="M16 8a6 6 0 0 1-8 5.7" /> <path d="M8 16a6 6 0 0 1 8-5.7" />
      </svg>
     </div><span class="logo-text">Terrascope</span> </a>
    <div class="nav-links"><a href="#" class="nav-link" onclick="showLaunchPage()">Home</a> <a href="#" class="nav-link">About</a> <a href="#" class="nav-link">Contact</a>
    </div><!-- Authentication Buttons -->
    <div id="authButtons" class="auth-buttons"><button class="auth-btn" onclick="showLoginModal()">Login</button> <button class="auth-btn primary" onclick="showSignupModal()">Sign Up</button>
    </div><!-- User Menu (hidden by default) -->
    <div id="userMenu" class="user-menu">
     <div class="user-avatar" onclick="toggleUserDropdown()" id="userAvatar">
      U
     </div>
     <div class="user-dropdown" id="userDropdown"><a href="#" class="dropdown-item">Profile</a> <a href="#" class="dropdown-item">Settings</a> <a href="#" class="dropdown-item" onclick="logout()">Logout</a>
     </div>
    </div>
   </nav><!-- Authentication Modal -->
   <div id="authModal" class="auth-modal">
    <div class="auth-container"><button class="close-modal" onclick="closeAuthModal()">Ã—</button>
     <div class="auth-header">
      <h2 class="auth-title" id="authTitle">Welcome Back</h2>
      <p class="auth-subtitle" id="authSubtitle">Sign in to your account</p>
     </div><!-- Google Sign-In Button -->
     <div class="google-auth-section"><button type="button" class="google-btn" onclick="handleGoogleAuth()">
       <svg width="20" height="20" viewbox="0 0 24 24" style="margin-right: 10px;"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" /> <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" /> <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" /> <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" />
       </svg><span id="googleBtnText">Continue with Google</span> </button>
      <div class="divider"><span>or</span>
      </div>
     </div>
     <form class="auth-form" id="authForm" onsubmit="handleAuth(event)">
      <div class="form-group" id="nameGroup" style="display: none;"><label class="form-label">Full Name</label> <input type="text" class="form-input" id="fullName" placeholder="Enter your full name">
      </div>
      <div class="form-group"><label class="form-label">Email</label> <input type="email" class="form-input" id="email" placeholder="Enter your email" required>
      </div>
      <div class="form-group"><label class="form-label">Password</label> <input type="password" class="form-input" id="password" placeholder="Enter your password" required>
      </div><button type="submit" class="form-submit" id="authSubmit">Sign In</button>
     </form>
     <div class="auth-switch"><span id="authSwitchText">Don't have an account?</span> <a href="#" id="authSwitchLink" onclick="toggleAuthMode()">Sign up</a>
     </div>
    </div>
   </div><!-- Launch Page -->
   <div id="launchPage" class="launch-page">
    <div class="hero-section">
     <h1 class="hero-title">Terrascope</h1>
     <p class="hero-subtitle">Your comprehensive Earth monitoring platform. Track weather patterns, monitor natural disasters, and stay informed about our planet's changing conditions.</p>
    </div>
    <div class="options-grid">
     <div class="option-card" onclick="showWeatherPage()">
      <div class="option-icon">
       <svg width="40" height="40" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z" /> <path d="M13 16l-4-4 4-4" /> <path d="M17 12h-4" />
       </svg>
      </div>
      <h3 class="option-title">Weather Monitoring</h3>
      <p class="option-description">Real-time weather data, forecasts, and climate monitoring for locations worldwide. Advanced atmospheric analysis and weather pattern tracking.</p>
     </div>
     <div class="option-card" onclick="showDisasterPage()">
      <div class="option-icon">
       <svg width="40" height="40" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 9v4" /> <path d="M12 17h.01" /> <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3" />
       </svg>
      </div>
      <h3 class="option-title">Disaster Tracking</h3>
      <p class="option-description">Advanced disaster monitoring system with real-time alerts, historical data analysis, and interactive visualization of global natural disasters.</p>
     </div>
    </div>
   </div><!-- Weather Page -->
   <div id="weatherPage" class="content-page">
    <div class="page-header">
     <h1 class="page-title">ðŸŒ¤ï¸ Weather Monitoring</h1><button class="back-btn" onclick="showLaunchPage()">â† Back to Home</button>
    </div>
    <div class="content-grid">
     <div class="content-card">
      <h2 class="section-title">ðŸ“ Your Location Weather</h2>
      <div class="weather-card" id="currentLocationWeather">
       <div class="weather-main">
        <div>
         <div class="temperature" id="currentTemp">
          Loading...
         </div>
         <div id="currentDesc">
          Getting your location...
         </div>
         <div id="currentLocation">
          ðŸ“ Current Location
         </div>
        </div>
        <div class="weather-icon" id="currentIcon">
         ðŸ”„
        </div>
       </div>
       <div class="weather-details">
        <div class="weather-item">
         <div>
          Humidity
         </div>
         <div id="currentHumidity">
          --
         </div>
        </div>
        <div class="weather-item">
         <div>
          Wind Speed
         </div>
         <div id="currentWind">
          --
         </div>
        </div>
        <div class="weather-item">
         <div>
          Pressure
         </div>
         <div id="currentPressure">
          --
         </div>
        </div>
        <div class="weather-item">
         <div>
          Visibility
         </div>
         <div id="currentVisibility">
          --
         </div>
        </div>
       </div>
      </div>
     </div>
     <div class="content-card">
      <h2 class="section-title">ðŸ” Search Weather</h2>
      <div class="location-input"><input type="text" id="locationInput" placeholder="Enter city name..." value=""> <button class="btn" onclick="updateWeather()">Search</button>
      </div>
      <div class="weather-card" id="searchWeatherCard" style="display: none;">
       <div class="weather-main">
        <div>
         <div class="temperature" id="searchTemp">
          --Â°C
         </div>
         <div id="searchDesc">
          --
         </div>
         <div id="searchLocation">
          --
         </div>
        </div>
        <div class="weather-icon" id="searchIcon">
         ðŸŒ¤ï¸
        </div>
       </div>
       <div class="weather-details">
        <div class="weather-item">
         <div>
          Humidity
         </div>
         <div id="searchHumidity">
          --
         </div>
        </div>
        <div class="weather-item">
         <div>
          Wind Speed
         </div>
         <div id="searchWind">
          --
         </div>
        </div>
        <div class="weather-item">
         <div>
          Pressure
         </div>
         <div id="searchPressure">
          --
         </div>
        </div>
        <div class="weather-item">
         <div>
          Visibility
         </div>
         <div id="searchVisibility">
          --
         </div>
        </div>
       </div>
      </div>
     </div>
    </div><!-- Pakistan Major Cities -->
    <div class="content-card" style="margin-top: 30px;">
     <h2 class="section-title">ðŸ‡µðŸ‡° Major Cities of Pakistan</h2>
     <div class="cities-grid" id="pakistanCities">
      <div class="city-card" onclick="loadCityWeather('Karachi')">
       <div class="city-name">
        Karachi
       </div>
       <div class="city-weather" id="karachi-weather">
        Loading...
       </div>
       <div class="city-temp" id="karachi-temp">
        --Â°C
       </div>
      </div>
      <div class="city-card" onclick="loadCityWeather('Lahore')">
       <div class="city-name">
        Lahore
       </div>
       <div class="city-weather" id="lahore-weather">
        Loading...
       </div>
       <div class="city-temp" id="lahore-temp">
        --Â°C
       </div>
      </div>
      <div class="city-card" onclick="loadCityWeather('Islamabad')">
       <div class="city-name">
        Islamabad
       </div>
       <div class="city-weather" id="islamabad-weather">
        Loading...
       </div>
       <div class="city-temp" id="islamabad-temp">
        --Â°C
       </div>
      </div>
      <div class="city-card" onclick="loadCityWeather('Faisalabad')">
       <div class="city-name">
        Faisalabad
       </div>
       <div class="city-weather" id="faisalabad-weather">
        Loading...
       </div>
       <div class="city-temp" id="faisalabad-temp">
        --Â°C
       </div>
      </div>
      <div class="city-card" onclick="loadCityWeather('Peshawar')">
       <div class="city-name">
        Peshawar
       </div>
       <div class="city-weather" id="peshawar-weather">
        Loading...
       </div>
       <div class="city-temp" id="peshawar-temp">
        --Â°C
       </div>
      </div>
     </div>
    </div>
   </div><!-- Professional Disaster Dashboard -->
   <div id="disasterPage" class="content-page"><!-- Dashboard Header -->
    <div class="dashboard-header">
     <div class="header-left">
      <h1 class="dashboard-title">
       <div class="title-icon">
        <svg width="32" height="32" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5z" /> <path d="M2 17l10 5 10-5" /> <path d="M2 12l10 5 10-5" />
        </svg>
       </div> Disaster Tracking Center</h1>
      <p class="dashboard-subtitle">Real-time monitoring and analysis of global natural disasters</p>
     </div>
     <div class="header-right">
      <div class="live-status">
       <div class="live-indicator"></div><span>LIVE</span>
      </div><button class="refresh-btn" onclick="updateRealTimeData()">
       <svg width="16" height="16" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 4 23 10 17 10" /> <polyline points="1 20 1 14 7 14" /> <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15" />
       </svg> Refresh </button> <button class="back-btn" onclick="showLaunchPage()">
       <svg width="16" height="16" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5" /> <path d="M12 19l-7-7 7-7" />
       </svg> Back </button>
     </div>
    </div><!-- Search and Filter Section -->
    <div class="search-filter-section">
     <div class="search-container">
      <div class="search-input-wrapper">
       <svg class="search-icon" width="20" height="20" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8" /> <path d="M21 21l-4.35-4.35" />
       </svg><input type="text" id="disasterSearch" placeholder="Search by location, date, or disaster type..." class="search-input"> <button class="search-btn" onclick="searchDisasters()">Search</button>
      </div>
     </div>
     <div class="filter-section">
      <div class="filter-group"><label class="filter-label">Time Range:</label> <select id="timeFilter" class="filter-select" onchange="filterByTime()"> <option value="7d">Last 7 Days</option> <option value="30d">Last 30 Days</option> <option value="1y">Last Year</option> <option value="5y">Last 5 Years</option> </select>
      </div>
      <div class="filter-group"><label class="filter-label">Disaster Type:</label>
       <div class="disaster-type-filters"><button class="type-filter active" data-type="all" onclick="filterDisasters('all')"> <span class="filter-icon">ðŸŒ</span> All </button> <button class="type-filter" data-type="earthquake" onclick="filterDisasters('earthquake')"> <span class="filter-icon">ðŸŒ‹</span> Earthquakes </button> <button class="type-filter" data-type="hurricane" onclick="filterDisasters('hurricane')"> <span class="filter-icon">ðŸŒ€</span> Hurricanes </button> <button class="type-filter" data-type="flood" onclick="filterDisasters('flood')"> <span class="filter-icon">ðŸŒŠ</span> Floods </button> <button class="type-filter" data-type="wildfire" onclick="filterDisasters('wildfire')"> <span class="filter-icon">ðŸ”¥</span> Wildfires </button>
       </div>
      </div>
     </div>
    </div><!-- Dashboard Grid -->
    <div class="dashboard-grid"><!-- Statistics Cards -->
     <div class="stats-section">
      <div class="stat-card" onclick="filterDisasters('earthquake')" style="cursor: pointer;">
       <div class="stat-icon earthquake-stat">
        <svg width="24" height="24" viewbox="0 0 24 24" fill="currentColor"><path d="M12 2L2 7l10 5 10-5-10-5z" /> <path d="M2 17l10 5 10-5" /> <path d="M2 12l10 5 10-5" />
        </svg>
       </div>
       <div class="stat-content">
        <div class="stat-number" id="earthquakeCount">
         0
        </div>
        <div class="stat-label">
         Earthquakes
        </div>
       </div>
      </div>
      <div class="stat-card" onclick="filterDisasters('hurricane')" style="cursor: pointer;">
       <div class="stat-icon hurricane-stat">
        <svg width="24" height="24" viewbox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
        </svg>
       </div>
       <div class="stat-content">
        <div class="stat-number" id="hurricaneCount">
         0
        </div>
        <div class="stat-label">
         Hurricanes
        </div>
       </div>
      </div>
      <div class="stat-card" onclick="filterDisasters('flood')" style="cursor: pointer;">
       <div class="stat-icon flood-stat">
        <svg width="24" height="24" viewbox="0 0 24 24" fill="currentColor"><path d="M12 2L2 7l10 5 10-5-10-5z" />
        </svg>
       </div>
       <div class="stat-content">
        <div class="stat-number" id="floodCount">
         0
        </div>
        <div class="stat-label">
         Floods
        </div>
       </div>
      </div>
      <div class="stat-card" onclick="filterDisasters('wildfire')" style="cursor: pointer;">
       <div class="stat-icon fire-stat">
        <svg width="24" height="24" viewbox="0 0 24 24" fill="currentColor"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z" />
        </svg>
       </div>
       <div class="stat-content">
        <div class="stat-number" id="wildfireCount">
         0
        </div>
        <div class="stat-label">
         Wildfires
        </div>
       </div>
      </div>
     </div><!-- Interactive Map -->
     <div class="map-section">
      <div class="section-header">
       <h3 class="section-title">
        <svg width="20" height="20" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" /> <circle cx="12" cy="10" r="3" />
        </svg> Interactive Disaster Map</h3>
       <div class="map-controls"><button class="map-control-btn" onclick="toggleMapAnimation()">
         <svg width="16" height="16" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3" />
         </svg> Animate </button> <button class="map-control-btn" onclick="resetMapView()">
         <svg width="16" height="16" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8" /> <path d="M21 3v5h-5" /> <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16" /> <path d="M8 16H3v5" />
         </svg> Reset </button>
       </div>
      </div>
      <div class="map-container">
       <div id="disasterMap" class="disaster-map"></div>
       <div class="map-legend">
        <div class="legend-item">
         <div class="legend-marker earthquake-marker"></div><span>Earthquakes</span>
        </div>
        <div class="legend-item">
         <div class="legend-marker hurricane-marker"></div><span>Hurricanes</span>
        </div>
        <div class="legend-item">
         <div class="legend-marker flood-marker"></div><span>Floods</span>
        </div>
        <div class="legend-item">
         <div class="legend-marker fire-marker"></div><span>Wildfires</span>
        </div>
       </div>
      </div>
     </div><!-- Events List with Columns -->
     <div class="events-section">
      <div class="section-header">
       <h3 class="section-title">
        <svg width="20" height="20" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" /> <polyline points="14,2 14,8 20,8" /> <line x1="16" y1="13" x2="8" y2="13" /> <line x1="16" y1="17" x2="8" y2="17" /> <polyline points="10,9 9,9 8,9" />
        </svg> Recent Events</h3>
       <div class="events-count"><span id="eventsCount">0</span> events found
       </div>
      </div><!-- Disaster Type Tabs -->
      <div class="disaster-tabs"><button class="disaster-tab active" data-tab="all" onclick="switchDisasterTab('all')"> <span class="tab-icon">ðŸŒ</span> <span class="tab-label">All Events</span> <span class="tab-count" id="allTabCount">0</span> </button> <button class="disaster-tab" data-tab="earthquake" onclick="switchDisasterTab('earthquake')"> <span class="tab-icon">ðŸŒ‹</span> <span class="tab-label">Earthquakes</span> <span class="tab-count" id="earthquakeTabCount">0</span> </button> <button class="disaster-tab" data-tab="hurricane" onclick="switchDisasterTab('hurricane')"> <span class="tab-icon">ðŸŒ€</span> <span class="tab-label">Hurricanes</span> <span class="tab-count" id="hurricaneTabCount">0</span> </button> <button class="disaster-tab" data-tab="flood" onclick="switchDisasterTab('flood')"> <span class="tab-icon">ðŸŒŠ</span> <span class="tab-label">Floods</span> <span class="tab-count" id="floodTabCount">0</span> </button> <button class="disaster-tab" data-tab="wildfire" onclick="switchDisasterTab('wildfire')"> <span class="tab-icon">ðŸ”¥</span> <span class="tab-label">Wildfires</span> <span class="tab-count" id="wildfireTabCount">0</span> </button>
      </div>
      <div class="events-list" id="disasterList">
       <div class="loading-state">
        <div class="loading-spinner"></div>
        <p>Loading disaster data...</p>
       </div>
      </div>
     </div>
    </div>
   </div>
  </div>
  <script>
        // Real-time data storage
        let disasters = [];
        let lastEarthquakeUpdate = 0;
        let weatherCache = new Map();
        let updateIntervals = [];

        // API Configuration
        const API_CONFIG = {
            // OpenWeatherMap API (free tier) - PASTE YOUR API KEY HERE
            WEATHER_API_KEY: '6ffc9e5dba1cdec95600aa9e0106c72f', // Replace with your actual API key
            WEATHER_BASE_URL: 'https://api.openweathermap.org/data/2.5/weather',
            
            // USGS Earthquake API (free, no key required)
            EARTHQUAKE_URL: 'https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/significant_week.geojson',
            
            // NASA EONET API for natural events (free, no key required)
            NASA_EVENTS_URL: 'https://eonet.gsfc.nasa.gov/api/v3/events',
            
            // Backup weather service (no key required)
            BACKUP_WEATHER_URL: 'https://api.open-meteo.com/v1/forecast'
        };

        // Google OAuth Configuration
        // IMPORTANT: Replace these with your actual Google OAuth credentials
        const GOOGLE_CLIENT_ID = '1022874443713-2fb3hot9nptgtj08pkks1csms4ejslte.apps.googleusercontent.com';
        const GOOGLE_CLIENT_SECRET = 'YOUR_GOOGLE_CLIENT_SECRET'; // Should be on backend only!

        // Professional space background initialization
        function initializeSpaceBackground() {
            createProfessionalStars();
        }

        // Create professional twinkling stars
        function createProfessionalStars() {
            const starsContainer = document.getElementById('stars');
            const starCount = 200;
            
            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                const size = Math.random() * 2 + 1;
                const brightness = Math.random();
                
                star.className = 'star';
                
                // Add variety to stars
                if (brightness > 0.8) {
                    star.classList.add('bright');
                } else if (brightness < 0.3) {
                    star.classList.add('distant');
                }
                
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.width = size + 'px';
                star.style.height = size + 'px';
                star.style.animationDelay = Math.random() * 4 + 's';
                star.style.animationDuration = (Math.random() * 4 + 3) + 's';
                
                starsContainer.appendChild(star);
            }
        }

        // Enhanced disaster data with 5-year historical data
        let historicalDisasters = [];
        let selectedEvent = null;
        let mapAnimationActive = false;
        let searchResults = [];

        // Generate historical disaster data (5 years)
        function generateHistoricalData() {
            const disasterTypes = ['earthquake', 'hurricane', 'flood', 'wildfire'];
            const locations = [
                { name: 'California, USA', lat: 36.7783, lng: -119.4179 },
                { name: 'Japan', lat: 36.2048, lng: 138.2529 },
                { name: 'Philippines', lat: 12.8797, lng: 121.7740 },
                { name: 'Indonesia', lat: -0.7893, lng: 113.9213 },
                { name: 'Chile', lat: -35.6751, lng: -71.5430 },
                { name: 'Turkey', lat: 38.9637, lng: 35.2433 },
                { name: 'Mexico', lat: 23.6345, lng: -102.5528 },
                { name: 'Italy', lat: 41.8719, lng: 12.5674 },
                { name: 'Greece', lat: 39.0742, lng: 21.8243 },
                { name: 'Australia', lat: -25.2744, lng: 133.7751 },
                { name: 'Brazil', lat: -14.2350, lng: -51.9253 },
                { name: 'India', lat: 20.5937, lng: 78.9629 }
            ];

            const currentDate = new Date();
            
            for (let year = 0; year < 5; year++) {
                for (let month = 0; month < 12; month++) {
                    const eventsInMonth = Math.floor(Math.random() * 8) + 2; // 2-10 events per month
                    
                    for (let i = 0; i < eventsInMonth; i++) {
                        const eventDate = new Date(currentDate.getFullYear() - year, month, Math.floor(Math.random() * 28) + 1);
                        const location = locations[Math.floor(Math.random() * locations.length)];
                        const type = disasterTypes[Math.floor(Math.random() * disasterTypes.length)];
                        
                        let magnitude, severity, impact;
                        
                        switch (type) {
                            case 'earthquake':
                                magnitude = (Math.random() * 4 + 4).toFixed(1); // 4.0-8.0
                                severity = magnitude >= 7 ? 'high' : magnitude >= 5.5 ? 'medium' : 'low';
                                impact = `Magnitude ${magnitude} earthquake`;
                                break;
                            case 'hurricane':
                                const category = Math.floor(Math.random() * 5) + 1;
                                magnitude = `Category ${category}`;
                                severity = category >= 4 ? 'high' : category >= 2 ? 'medium' : 'low';
                                impact = `${magnitude} hurricane with winds up to ${category * 30 + 70} mph`;
                                break;
                            case 'flood':
                                const floodLevel = Math.floor(Math.random() * 10) + 1;
                                magnitude = `Level ${floodLevel}`;
                                severity = floodLevel >= 8 ? 'high' : floodLevel >= 5 ? 'medium' : 'low';
                                impact = `Severe flooding affecting ${floodLevel * 1000} people`;
                                break;
                            case 'wildfire':
                                const acres = Math.floor(Math.random() * 50000) + 1000;
                                magnitude = `${acres} acres`;
                                severity = acres >= 30000 ? 'high' : acres >= 10000 ? 'medium' : 'low';
                                impact = `Wildfire burned ${acres} acres`;
                                break;
                        }
                        
                        historicalDisasters.push({
                            id: `${type}-${eventDate.getTime()}-${Math.random().toString(36).substr(2, 9)}`,
                            type: type.charAt(0).toUpperCase() + type.slice(1),
                            name: `${impact} - ${location.name}`,
                            date: eventDate.toISOString().split('T')[0],
                            location: location.name,
                            lat: location.lat + (Math.random() - 0.5) * 2, // Add some variation
                            lng: location.lng + (Math.random() - 0.5) * 2,
                            severity: severity,
                            magnitude: magnitude,
                            impact: impact,
                            category: type.toLowerCase(), // Ensure category is lowercase for consistent matching
                            timestamp: eventDate.getTime()
                        });
                    }
                }
            }
            
            // Sort by date (newest first)
            historicalDisasters.sort((a, b) => b.timestamp - a.timestamp);
        }

        // Enhanced search functionality with real-time search
        function searchDisasters() {
            const searchTerm = document.getElementById('disasterSearch').value.toLowerCase().trim();
            
            if (!searchTerm) {
                // Reset to show all disasters for current filter
                renderDisasters();
                showUpdateNotification('Search cleared - showing all events');
                return;
            }
            
            // Get base disasters for current filter
            const baseDisasters = currentFilter === 'all' 
                ? disasters 
                : disasters.filter(d => d.category === currentFilter);
            
            // Search across multiple fields
            const searchResults = baseDisasters.filter(disaster => {
                const searchableText = [
                    disaster.location,
                    disaster.type,
                    disaster.name,
                    disaster.date,
                    disaster.severity,
                    disaster.magnitude?.toString() || '',
                    disaster.impact || '',
                    disaster.category
                ].join(' ').toLowerCase();
                
                // Support multiple search terms
                const searchTerms = searchTerm.split(' ').filter(term => term.length > 0);
                return searchTerms.every(term => searchableText.includes(term));
            });
            
            // Render filtered results
            renderSearchResults(searchResults, searchTerm);
            
            // Update map markers for search results
            renderSearchMarkers(searchResults);
            
            showUpdateNotification(`Found ${searchResults.length} matching events`);
        }

        // Real-time search as user types
        function setupRealTimeSearch() {
            const searchInput = document.getElementById('disasterSearch');
            let searchTimeout;
            
            searchInput.addEventListener('input', function() {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    searchDisasters();
                }, 300); // Debounce search by 300ms
            });
            
            // Clear search on escape key
            searchInput.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    this.value = '';
                    searchDisasters();
                }
            });
        }

        // Render search results with highlighting
        function renderSearchResults(results, searchTerm) {
            const disasterList = document.getElementById('disasterList');
            
            if (results.length === 0) {
                disasterList.innerHTML = `
                    <div class="loading-state">
                        <div style="font-size: 2rem; margin-bottom: 16px;">ðŸ”</div>
                        <p>No disasters found matching "${searchTerm}"</p>
                        <p style="font-size: 0.875rem; color: #64748b; margin-top: 8px;">
                            Try searching by location, disaster type, date, or severity
                        </p>
                    </div>
                `;
                return;
            }

            disasterList.innerHTML = results.map(disaster => {
                // Highlight search terms in the results
                const highlightedName = highlightSearchTerm(disaster.name, searchTerm);
                const highlightedLocation = highlightSearchTerm(disaster.location, searchTerm);
                
                return `
                    <div class="disaster-event ${disaster.category} severity-${disaster.severity}" 
                         data-event-id="${disaster.id}" 
                         onclick="selectDisasterEvent('${disaster.id}')">
                        <div class="event-header">
                            <div class="event-title">${highlightedName}</div>
                            <div class="event-severity severity-${disaster.severity}">
                                ${disaster.severity.toUpperCase()}
                            </div>
                        </div>
                        <div class="event-details">
                            <div class="event-location">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                                    <circle cx="12" cy="10" r="3"/>
                                </svg>
                                ${highlightedLocation}
                            </div>
                            <div class="event-date">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                                    <line x1="16" y1="2" x2="16" y2="6"/>
                                    <line x1="8" y1="2" x2="8" y2="6"/>
                                    <line x1="3" y1="10" x2="21" y2="10"/>
                                </svg>
                                ${new Date(disaster.date).toLocaleDateString('en-US', { 
                                    year: 'numeric', 
                                    month: 'short', 
                                    day: 'numeric' 
                                })}
                            </div>
                            ${disaster.magnitude ? `
                                <div class="event-magnitude">
                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                                    </svg>
                                    ${disaster.magnitude}
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
            
            // Update events count
            document.getElementById('eventsCount').textContent = results.length;
        }

        // Highlight search terms in text
        function highlightSearchTerm(text, searchTerm) {
            if (!searchTerm || !text) return text;
            
            const searchTerms = searchTerm.split(' ').filter(term => term.length > 0);
            let highlightedText = text;
            
            searchTerms.forEach(term => {
                const regex = new RegExp(`(${term})`, 'gi');
                highlightedText = highlightedText.replace(regex, '<mark style="background: rgba(59, 130, 246, 0.3); color: inherit; padding: 1px 2px; border-radius: 2px;">$1</mark>');
            });
            
            return highlightedText;
        }

        // Render markers for search results
        function renderSearchMarkers(results) {
            if (!disasterMap) return;
            
            // Clear existing markers
            disasterMarkers.forEach(marker => disasterMap.removeLayer(marker));
            disasterMarkers = [];
            
            // Add markers for search results
            results.forEach(disaster => {
                const color = getDisasterColor(disaster.category);
                const marker = L.circleMarker([disaster.lat, disaster.lng], {
                    radius: 6,
                    fillColor: color,
                    color: '#ffffff',
                    weight: 2,
                    opacity: 0.8,
                    fillOpacity: 0.6
                }).addTo(disasterMap);
                
                // Add popup with disaster info
                marker.bindPopup(`
                    <div style="font-size: 0.875rem;">
                        <strong>${disaster.name}</strong><br>
                        ðŸ“ ${disaster.location}<br>
                        ðŸ“… ${disaster.date}<br>
                        âš ï¸ ${disaster.severity.toUpperCase()} severity
                        ${disaster.magnitude ? `<br>ðŸ“Š ${disaster.magnitude}` : ''}
                    </div>
                `);
                
                // Click to select event
                marker.on('click', () => {
                    selectDisasterEvent(disaster.id);
                });
                
                disasterMarkers.push(marker);
            });
            
            // Fit map to show all search results if there are any
            if (results.length > 0 && results.length < 20) {
                const group = new L.featureGroup(disasterMarkers);
                disasterMap.fitBounds(group.getBounds().pad(0.1));
            }
        }

        // Time-based filtering
        function filterByTime() {
            const timeFilter = document.getElementById('timeFilter').value;
            const currentDate = new Date();
            let cutoffDate;
            
            switch (timeFilter) {
                case '7d':
                    cutoffDate = new Date(currentDate.getTime() - 7 * 24 * 60 * 60 * 1000);
                    break;
                case '30d':
                    cutoffDate = new Date(currentDate.getTime() - 30 * 24 * 60 * 60 * 1000);
                    break;
                case '1y':
                    cutoffDate = new Date(currentDate.getTime() - 365 * 24 * 60 * 60 * 1000);
                    break;
                case '5y':
                    cutoffDate = new Date(currentDate.getTime() - 5 * 365 * 24 * 60 * 60 * 1000);
                    disasters = [...historicalDisasters];
                    break;
                default:
                    cutoffDate = new Date(currentDate.getTime() - 7 * 24 * 60 * 60 * 1000);
            }
            
            if (timeFilter === '5y') {
                disasters = [...historicalDisasters];
            } else {
                disasters = historicalDisasters.filter(disaster => 
                    new Date(disaster.date) >= cutoffDate
                );
            }
            
            renderDisasters();
            renderDisasterMarkers();
            updateStatistics();
            showUpdateNotification(`Filtered to ${disasters.length} events from ${timeFilter}`);
        }

        // Enhanced event selection with proper animation management
        function selectDisasterEvent(eventId) {
            console.log('Selecting disaster event:', eventId);
            
            // ALWAYS clear any existing animations first - this is critical
            clearMapAnimations();
            
            // Remove previous selection
            document.querySelectorAll('.disaster-event').forEach(el => {
                el.classList.remove('selected');
            });
            
            // Find and select the event
            const eventElement = document.querySelector(`[data-event-id="${eventId}"]`);
            if (eventElement) {
                eventElement.classList.add('selected');
                console.log('Event element selected');
            }
            
            // Find the disaster data
            selectedEvent = disasters.find(d => d.id === eventId);
            
            if (selectedEvent && disasterMap) {
                console.log('Selected disaster:', selectedEvent.type, 'Category:', selectedEvent.category);
                
                // Animate to the selected event on map
                disasterMap.setView([selectedEvent.lat, selectedEvent.lng], 8, {
                    animate: true,
                    duration: 1
                });
                
                // Start disaster animation immediately - no transition delay
                setTimeout(() => {
                    console.log('Starting animation for category:', selectedEvent.category);
                    animateDisasterOnMap(selectedEvent);
                }, 100); // Minimal delay just for map to center
            } else {
                console.log('No disaster found or map not initialized');
            }
        }

        // Animation management system
        let activeAnimationLayers = [];
        let animationTimeouts = [];
        let animationIntervals = [];
        let animationFrames = [];
        
        function clearMapAnimations() {
            console.log('Clearing all map animations...');
            
            // Clear all animation layers
            activeAnimationLayers.forEach(layer => {
                if (disasterMap && disasterMap.hasLayer(layer)) {
                    disasterMap.removeLayer(layer);
                }
            });
            activeAnimationLayers = [];
            
            // Clear all timeouts
            animationTimeouts.forEach(timeout => clearTimeout(timeout));
            animationTimeouts = [];
            
            // Clear all intervals
            animationIntervals.forEach(interval => clearInterval(interval));
            animationIntervals = [];
            
            // Clear all animation frames
            animationFrames.forEach(frame => cancelAnimationFrame(frame));
            animationFrames = [];
            
            console.log('All animations cleared');
        }

        // Animate disaster visualization on map with type-specific animations
        function animateDisasterOnMap(disaster) {
            if (!disasterMap) return;
            
            // Always clear previous animations first
            clearMapAnimations();
            
            const color = getDisasterColor(disaster.category);
            const lat = disaster.lat;
            const lng = disaster.lng;
            
            // Add main disaster marker
            const mainMarker = L.circleMarker([lat, lng], {
                radius: 8,
                fillColor: color,
                color: '#ffffff',
                weight: 2,
                opacity: 1,
                fillOpacity: 0.8
            }).addTo(disasterMap);
            
            activeAnimationLayers.push(mainMarker);
            
            // Normalize disaster category to lowercase for consistent matching
            const category = disaster.category.toLowerCase();
            
            // Different animations based on disaster type
            switch (category) {
                case 'earthquake':
                    animateEarthquake(lat, lng, color, disaster.severity);
                    break;
                case 'hurricane':
                case 'storm':
                case 'cyclone':
                    animateHurricane(lat, lng, color, disaster.severity);
                    break;
                case 'flood':
                case 'flooding':
                    animateFlood(lat, lng, color, disaster.severity);
                    break;
                case 'wildfire':
                case 'fire':
                case 'bushfire':
                    animateWildfire(lat, lng, color, disaster.severity);
                    break;
                default:
                    // For any unrecognized disaster type, use generic animation
                    animateGenericDisaster(lat, lng, color, disaster.severity);
            }
        }

        // Earthquake animation - Concentric shock waves
        function animateEarthquake(lat, lng, color, severity) {
            const maxRadius = severity === 'high' ? 80000 : severity === 'medium' ? 50000 : 25000;
            const waveCount = severity === 'high' ? 4 : severity === 'medium' ? 3 : 2;
            
            for (let i = 0; i < waveCount; i++) {
                const timeout = setTimeout(() => {
                    if (!disasterMap) return;
                    
                    const shockWave = L.circle([lat, lng], {
                        radius: 1000,
                        fillColor: color,
                        color: color,
                        weight: 3,
                        opacity: 0.8,
                        fillOpacity: 0.2
                    }).addTo(disasterMap);
                    
                    activeAnimationLayers.push(shockWave);
                    
                    let currentRadius = 1000;
                    let animationId;
                    
                    const animateWave = () => {
                        if (!disasterMap || !disasterMap.hasLayer(shockWave)) return;
                        
                        currentRadius += 3000;
                        const opacity = Math.max(0, 0.8 - (currentRadius / maxRadius) * 0.8);
                        
                        shockWave.setRadius(currentRadius);
                        shockWave.setStyle({ 
                            opacity: opacity,
                            fillOpacity: opacity * 0.3
                        });
                        
                        if (currentRadius < maxRadius && opacity > 0) {
                            animationId = requestAnimationFrame(animateWave);
                            animationFrames.push(animationId);
                        } else {
                            const cleanupTimeout = setTimeout(() => {
                                if (disasterMap && disasterMap.hasLayer(shockWave)) {
                                    disasterMap.removeLayer(shockWave);
                                }
                            }, 500);
                            animationTimeouts.push(cleanupTimeout);
                        }
                    };
                    
                    animateWave();
                }, i * 800);
                
                animationTimeouts.push(timeout);
            }
        }

        // Hurricane animation - Spiral pattern
        function animateHurricane(lat, lng, color, severity) {
            const maxRadius = severity === 'high' ? 100000 : severity === 'medium' ? 60000 : 35000;
            const spiralArms = 3;
            
            // Create eye of the storm
            const eye = L.circle([lat, lng], {
                radius: 5000,
                fillColor: '#2c3e50',
                color: color,
                weight: 2,
                opacity: 1,
                fillOpacity: 0.8
            }).addTo(disasterMap);
            
            activeAnimationLayers.push(eye);
            
            // Create spiral arms
            for (let arm = 0; arm < spiralArms; arm++) {
                const armPoints = [];
                const angleOffset = (arm * 120) * (Math.PI / 180);
                
                for (let i = 0; i <= 50; i++) {
                    const angle = angleOffset + (i * 0.3);
                    const radius = (i / 50) * maxRadius;
                    const spiralLat = lat + (radius / 111000) * Math.cos(angle);
                    const spiralLng = lng + (radius / (111000 * Math.cos(lat * Math.PI / 180))) * Math.sin(angle);
                    armPoints.push([spiralLat, spiralLng]);
                }
                
                const timeout = setTimeout(() => {
                    if (!disasterMap) return;
                    
                    const spiralArm = L.polyline(armPoints, {
                        color: color,
                        weight: 4,
                        opacity: 0.7,
                        dashArray: '10, 5'
                    }).addTo(disasterMap);
                    
                    activeAnimationLayers.push(spiralArm);
                    
                    // Animate the spiral rotation
                    let rotation = 0;
                    let rotationId;
                    const rotateSpiral = () => {
                        if (!disasterMap || !disasterMap.hasLayer(spiralArm)) return;
                        
                        rotation += 2;
                        if (rotation < 360) {
                            rotationId = requestAnimationFrame(rotateSpiral);
                            animationFrames.push(rotationId);
                        }
                    };
                    rotateSpiral();
                    
                }, arm * 300);
                
                animationTimeouts.push(timeout);
            }
            
            // Auto cleanup after animation
            const cleanupTimeout = setTimeout(() => {
                // Animation will be cleared when user selects another disaster
            }, 8000);
            animationTimeouts.push(cleanupTimeout);
        }

        // Flood animation - Realistic water spreading pattern
        function animateFlood(lat, lng, color, severity) {
            const maxRadius = severity === 'high' ? 70000 : severity === 'medium' ? 45000 : 25000;
            const floodZones = severity === 'high' ? 6 : severity === 'medium' ? 4 : 3;
            
            // Create main flood area with water-like appearance
            const mainFloodArea = L.circle([lat, lng], {
                radius: 3000,
                fillColor: '#1e40af',
                color: '#3b82f6',
                weight: 2,
                opacity: 0.8,
                fillOpacity: 0.6
            }).addTo(disasterMap);
            
            activeAnimationLayers.push(mainFloodArea);
            
            // Create expanding flood zones that look like water spreading
            for (let i = 0; i < floodZones; i++) {
                const timeout = setTimeout(() => {
                    if (!disasterMap) return;
                    
                    // Create irregular flood shapes to simulate natural water flow
                    const floodPoints = [];
                    const baseRadius = 5000 + (i * 8000);
                    const numPoints = 12;
                    
                    for (let j = 0; j < numPoints; j++) {
                        const angle = (j * 360 / numPoints) * (Math.PI / 180);
                        // Add randomness to make it look like natural water flow
                        const radiusVariation = baseRadius * (0.7 + Math.random() * 0.6);
                        const pointLat = lat + (radiusVariation / 111000) * Math.cos(angle);
                        const pointLng = lng + (radiusVariation / (111000 * Math.cos(lat * Math.PI / 180))) * Math.sin(angle);
                        floodPoints.push([pointLat, pointLng]);
                    }
                    
                    // Close the polygon
                    floodPoints.push(floodPoints[0]);
                    
                    const floodZone = L.polygon(floodPoints, {
                        fillColor: '#06b6d4',
                        color: '#0891b2',
                        weight: 1,
                        opacity: 0.7 - (i * 0.1),
                        fillOpacity: 0.4 - (i * 0.05),
                        dashArray: '3, 6'
                    }).addTo(disasterMap);
                    
                    activeAnimationLayers.push(floodZone);
                    
                    // Animate water flow effect
                    let flowPhase = 0;
                    let flowAnimationId;
                    
                    const animateWaterFlow = () => {
                        if (!disasterMap || !disasterMap.hasLayer(floodZone)) return;
                        
                        flowPhase += 0.1;
                        const opacity = (0.4 - (i * 0.05)) * (0.8 + 0.2 * Math.sin(flowPhase));
                        
                        floodZone.setStyle({
                            fillOpacity: Math.max(0.1, opacity),
                            opacity: Math.max(0.2, 0.7 - (i * 0.1) + 0.1 * Math.sin(flowPhase))
                        });
                        
                        if (flowPhase < Math.PI * 4) { // Run for 4 cycles
                            flowAnimationId = requestAnimationFrame(animateWaterFlow);
                            animationFrames.push(flowAnimationId);
                        }
                    };
                    
                    animateWaterFlow();
                    
                }, i * 800);
                
                animationTimeouts.push(timeout);
            }
            
            // Create water ripple effects
            for (let ripple = 0; ripple < 8; ripple++) {
                const rippleTimeout = setTimeout(() => {
                    if (!disasterMap) return;
                    
                    const rippleCircle = L.circle([lat, lng], {
                        radius: 1000,
                        fillColor: 'transparent',
                        color: '#0ea5e9',
                        weight: 2,
                        opacity: 0.8,
                        fillOpacity: 0
                    }).addTo(disasterMap);
                    
                    activeAnimationLayers.push(rippleCircle);
                    
                    let rippleRadius = 1000;
                    let rippleAnimationId;
                    
                    const animateRipple = () => {
                        if (!disasterMap || !disasterMap.hasLayer(rippleCircle)) return;
                        
                        rippleRadius += 3000;
                        const rippleOpacity = Math.max(0, 0.8 - (rippleRadius / maxRadius) * 0.8);
                        
                        rippleCircle.setRadius(rippleRadius);
                        rippleCircle.setStyle({ opacity: rippleOpacity });
                        
                        if (rippleRadius < maxRadius && rippleOpacity > 0.1) {
                            rippleAnimationId = requestAnimationFrame(animateRipple);
                            animationFrames.push(rippleAnimationId);
                        } else {
                            const cleanupTimeout = setTimeout(() => {
                                if (disasterMap && disasterMap.hasLayer(rippleCircle)) {
                                    disasterMap.removeLayer(rippleCircle);
                                }
                            }, 500);
                            animationTimeouts.push(cleanupTimeout);
                        }
                    };
                    
                    animateRipple();
                }, ripple * 400);
                
                animationTimeouts.push(rippleTimeout);
            }
        }

        // Wildfire animation - Spreading fire pattern
        function animateWildfire(lat, lng, color, severity) {
            const maxRadius = severity === 'high' ? 60000 : severity === 'medium' ? 40000 : 20000;
            const fireSpots = severity === 'high' ? 8 : severity === 'medium' ? 6 : 4;
            
            // Main fire center
            const mainFire = L.circle([lat, lng], {
                radius: 3000,
                fillColor: color,
                color: '#dc2626',
                weight: 3,
                opacity: 1,
                fillOpacity: 0.7
            }).addTo(disasterMap);
            
            activeAnimationLayers.push(mainFire);
            
            // Create spreading fire spots
            for (let i = 0; i < fireSpots; i++) {
                const timeout = setTimeout(() => {
                    if (!disasterMap) return;
                    
                    const angle = (i * 360 / fireSpots) * (Math.PI / 180);
                    const distance = Math.random() * maxRadius * 0.7;
                    const fireLat = lat + (distance / 111000) * Math.cos(angle);
                    const fireLng = lng + (distance / (111000 * Math.cos(lat * Math.PI / 180))) * Math.sin(angle);
                    
                    const fireSpot = L.circle([fireLat, fireLng], {
                        radius: 1000,
                        fillColor: color,
                        color: '#ea580c',
                        weight: 2,
                        opacity: 0.8,
                        fillOpacity: 0.6
                    }).addTo(disasterMap);
                    
                    activeAnimationLayers.push(fireSpot);
                    
                    // Animate fire spread
                    let currentRadius = 1000;
                    const maxSpotRadius = maxRadius * 0.3;
                    let spreadAnimationId;
                    
                    const spreadFire = () => {
                        if (!disasterMap || !disasterMap.hasLayer(fireSpot)) return;
                        
                        currentRadius += 1500;
                        const intensity = Math.max(0.3, 1 - (currentRadius / maxSpotRadius));
                        
                        fireSpot.setRadius(currentRadius);
                        fireSpot.setStyle({ 
                            opacity: intensity,
                            fillOpacity: intensity * 0.6,
                            fillColor: intensity > 0.6 ? color : '#f97316'
                        });
                        
                        if (currentRadius < maxSpotRadius) {
                            spreadAnimationId = requestAnimationFrame(spreadFire);
                            animationFrames.push(spreadAnimationId);
                        }
                    };
                    
                    spreadFire();
                }, i * 400);
                
                animationTimeouts.push(timeout);
            }
            
            // Animate main fire pulsing
            let pulseCount = 0;
            const pulseFire = () => {
                if (!disasterMap || !disasterMap.hasLayer(mainFire) || pulseCount >= 10) return;
                
                const scale = 1 + Math.sin(pulseCount * 0.5) * 0.3;
                mainFire.setRadius(3000 * scale);
                pulseCount++;
                
                const pulseTimeout = setTimeout(pulseFire, 300);
                animationTimeouts.push(pulseTimeout);
            };
            pulseFire();
        }

        // Generic disaster animation fallback
        function animateGenericDisaster(lat, lng, color, severity) {
            const maxRadius = severity === 'high' ? 50000 : severity === 'medium' ? 30000 : 15000;
            
            const genericMarker = L.circle([lat, lng], {
                radius: 1000,
                fillColor: color,
                color: color,
                weight: 3,
                opacity: 0.8,
                fillOpacity: 0.3
            }).addTo(disasterMap);
            
            activeAnimationLayers.push(genericMarker);
            
            let currentRadius = 1000;
            let expansionAnimationId;
            
            const animateExpansion = () => {
                if (!disasterMap || !disasterMap.hasLayer(genericMarker)) return;
                
                currentRadius += 2000;
                genericMarker.setRadius(currentRadius);
                
                if (currentRadius < maxRadius) {
                    expansionAnimationId = requestAnimationFrame(animateExpansion);
                    animationFrames.push(expansionAnimationId);
                } else {
                    const cleanupTimeout = setTimeout(() => {
                        if (disasterMap && disasterMap.hasLayer(genericMarker)) {
                            disasterMap.removeLayer(genericMarker);
                        }
                    }, 2000);
                    animationTimeouts.push(cleanupTimeout);
                }
            };
            
            animateExpansion();
        }

        // Toggle map animation mode
        function toggleMapAnimation() {
            // If no disaster is selected, show helpful message
            if (!selectedEvent) {
                showSelectionPrompt();
                return;
            }
            
            mapAnimationActive = !mapAnimationActive;
            const btn = document.querySelector('.map-control-btn');
            
            if (mapAnimationActive) {
                btn.innerHTML = `
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="6" y="4" width="4" height="16"/>
                        <rect x="14" y="4" width="4" height="16"/>
                    </svg>
                    Pause
                `;
                startMapAnimation();
            } else {
                btn.innerHTML = `
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polygon points="5 3 19 12 5 21 5 3"/>
                    </svg>
                    Animate
                `;
                stopMapAnimation();
            }
        }

        // Show selection prompt when no disaster is selected
        function showSelectionPrompt() {
            // Remove any existing prompt
            const existingPrompt = document.querySelector('.selection-prompt');
            if (existingPrompt) {
                existingPrompt.remove();
            }
            
            // Create selection prompt
            const prompt = document.createElement('div');
            prompt.className = 'selection-prompt';
            prompt.style.cssText = `
                position: absolute;
                top: 60px;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(239, 68, 68, 0.95);
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                font-size: 0.875rem;
                font-weight: 500;
                box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
                z-index: 1000;
                animation: promptSlideIn 0.3s ease-out;
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.2);
                max-width: 280px;
                text-align: center;
            `;
            
            prompt.innerHTML = `
                <div style="display: flex; align-items: center; gap: 8px; justify-content: center;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 9v4"/>
                        <path d="M12 17h.01"/>
                        <circle cx="12" cy="12" r="10"/>
                    </svg>
                    <span>Please select a disaster first</span>
                </div>
                <div style="font-size: 0.75rem; opacity: 0.9; margin-top: 4px;">
                    Click on any event from the list â†’
                </div>
            `;
            
            // Add to map container
            const mapSection = document.querySelector('.map-section');
            mapSection.style.position = 'relative';
            mapSection.appendChild(prompt);
            
            // Auto-remove after 4 seconds
            setTimeout(() => {
                if (prompt.parentNode) {
                    prompt.style.animation = 'promptSlideOut 0.3s ease-out';
                    setTimeout(() => prompt.remove(), 300);
                }
            }, 4000);
        }

        // Start map animation for selected disaster
        function startMapAnimation() {
            if (!mapAnimationActive || !selectedEvent) return;
            
            console.log('Starting animation for selected disaster:', selectedEvent.name);
            
            // Refocus on the selected disaster
            if (disasterMap) {
                disasterMap.setView([selectedEvent.lat, selectedEvent.lng], 8, {
                    animate: true,
                    duration: 1
                });
            }
            
            // Start the animation after a brief moment for map to center
            setTimeout(() => {
                animateDisasterOnMap(selectedEvent);
            }, 500);
        }

        // Stop map animation
        function stopMapAnimation() {
            mapAnimationActive = false;
            clearMapAnimations();
        }

        // Reset map view
        function resetMapView() {
            if (disasterMap) {
                // Clear animations before resetting view
                clearMapAnimations();
                
                disasterMap.setView([20, 0], 2, { animate: true });
                selectedEvent = null;
                
                // Remove selection from events
                document.querySelectorAll('.disaster-event').forEach(el => {
                    el.classList.remove('selected');
                });
            }
        }

        // Update statistics counters
        function updateStatistics() {
            const stats = {
                earthquake: disasters.filter(d => d.category === 'earthquake').length,
                hurricane: disasters.filter(d => d.category === 'hurricane').length,
                flood: disasters.filter(d => d.category === 'flood').length,
                wildfire: disasters.filter(d => d.category === 'wildfire').length
            };
            
            // Animate counter updates for stat cards
            Object.keys(stats).forEach(type => {
                const element = document.getElementById(`${type}Count`);
                if (element) {
                    animateCounter(element, parseInt(element.textContent) || 0, stats[type]);
                }
            });
            
            // Update tab counts
            const tabCounts = {
                all: disasters.length,
                earthquake: stats.earthquake,
                hurricane: stats.hurricane,
                flood: stats.flood,
                wildfire: stats.wildfire
            };
            
            Object.keys(tabCounts).forEach(type => {
                const tabElement = document.getElementById(`${type}TabCount`);
                if (tabElement) {
                    animateCounter(tabElement, parseInt(tabElement.textContent) || 0, tabCounts[type]);
                }
            });
            
            // Update events count
            const eventsCountElement = document.getElementById('eventsCount');
            if (eventsCountElement) {
                const filteredCount = currentFilter === 'all' 
                    ? disasters.length 
                    : disasters.filter(d => d.category === currentFilter).length;
                animateCounter(eventsCountElement, parseInt(eventsCountElement.textContent) || 0, filteredCount);
            }
        }

        // Animate counter numbers
        function animateCounter(element, start, end) {
            const duration = 1000;
            const startTime = performance.now();
            
            const animate = (currentTime) => {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                const current = Math.floor(start + (end - start) * progress);
                element.textContent = current;
                
                if (progress < 1) {
                    requestAnimationFrame(animate);
                }
            };
            
            requestAnimationFrame(animate);
        }

        // Real-time weather fetching
        async function fetchRealWeather(city) {
            const cacheKey = city.toLowerCase();
            const cached = weatherCache.get(cacheKey);
            
            // Use cache if data is less than 10 minutes old
            if (cached && Date.now() - cached.timestamp < 600000) {
                return cached.data;
            }

            try {
                // Try OpenWeatherMap first (requires API key)
                if (API_CONFIG.WEATHER_API_KEY !== '6ffc9e5dba1cdec95600aa9e0106c72f') {
                    const response = await fetch(
                        `${API_CONFIG.WEATHER_BASE_URL}?q=${encodeURIComponent(city)}&appid=${API_CONFIG.WEATHER_API_KEY}&units=metric`
                    );
                    
                    if (response.ok) {
                        const data = await response.json();
                        const weatherData = {
                            temperature: `${Math.round(data.main.temp)}Â°C`,
                            description: data.weather[0].description,
                            location: `${data.name}, ${data.sys.country}`,
                            icon: getWeatherIcon(data.weather[0].icon),
                            humidity: `${data.main.humidity}%`,
                            windSpeed: `${Math.round(data.wind.speed * 3.6)} km/h`,
                            pressure: `${data.main.pressure} hPa`,
                            visibility: `${Math.round(data.visibility / 1000)} km`,
                            timestamp: Date.now()
                        };
                        
                        weatherCache.set(cacheKey, { data: weatherData, timestamp: Date.now() });
                        return weatherData;
                    }
                }

                // Fallback to Open-Meteo (no API key required)
                const geocodeResponse = await fetch(
                    `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(city)}&count=1`
                );
                
                if (geocodeResponse.ok) {
                    const geocodeData = await geocodeResponse.json();
                    if (geocodeData.results && geocodeData.results.length > 0) {
                        const location = geocodeData.results[0];
                        const weatherResponse = await fetch(
                            `${API_CONFIG.BACKUP_WEATHER_URL}?latitude=${location.latitude}&longitude=${location.longitude}&current_weather=true&hourly=relative_humidity_2m,surface_pressure,visibility`
                        );
                        
                        if (weatherResponse.ok) {
                            const weatherData = await weatherResponse.json();
                            const current = weatherData.current_weather;
                            
                            const processedData = {
                                temperature: `${Math.round(current.temperature)}Â°C`,
                                description: getWeatherDescription(current.weathercode),
                                location: `${location.name}, ${location.country}`,
                                icon: getWeatherIconFromCode(current.weathercode),
                                humidity: `${weatherData.hourly.relative_humidity_2m[0] || 'N/A'}%`,
                                windSpeed: `${Math.round(current.windspeed)} km/h`,
                                pressure: `${Math.round(weatherData.hourly.surface_pressure[0] || 1013)} hPa`,
                                visibility: `${Math.round((weatherData.hourly.visibility[0] || 10000) / 1000)} km`,
                                timestamp: Date.now()
                            };
                            
                            weatherCache.set(cacheKey, { data: processedData, timestamp: Date.now() });
                            return processedData;
                        }
                    }
                }
            } catch (error) {
                console.error('Weather API error:', error);
            }

            // Return fallback data if all APIs fail
            return getFallbackWeatherData(city);
        }

        // Real-time earthquake data fetching
        async function fetchRealEarthquakes() {
            try {
                const response = await fetch(API_CONFIG.EARTHQUAKE_URL);
                if (response.ok) {
                    const data = await response.json();
                    const earthquakes = data.features.map(feature => {
                        const props = feature.properties;
                        const coords = feature.geometry.coordinates;
                        
                        return {
                            id: `earthquake-${props.time}-${Math.random().toString(36).substr(2, 9)}`,
                            type: 'Earthquake',
                            name: `Magnitude ${props.mag} Earthquake`,
                            date: new Date(props.time).toISOString().split('T')[0],
                            location: props.place,
                            severity: props.mag >= 7 ? 'high' : props.mag >= 5.5 ? 'medium' : 'low',
                            impact: `${props.mag} magnitude earthquake ${props.tsunami ? 'with tsunami risk' : ''}`,
                            category: 'earthquake', // Ensure lowercase
                            lat: coords[1],
                            lng: coords[0],
                            magnitude: props.mag,
                            depth: coords[2],
                            timestamp: props.time
                        };
                    });
                    
                    return earthquakes;
                }
            } catch (error) {
                console.error('Earthquake API error:', error);
            }
            return [];
        }

        // Real-time NASA events fetching
        async function fetchNASAEvents() {
            try {
                const response = await fetch(`${API_CONFIG.NASA_EVENTS_URL}?limit=50&days=30`);
                if (response.ok) {
                    const data = await response.json();
                    const events = data.events
                        .filter(event => event.geometry && event.geometry.length > 0)
                        .map(event => {
                            const geometry = event.geometry[0];
                            const coords = geometry.coordinates || [0, 0];
                            
                            let category = 'other';
                            let type = event.title;
                            
                            if (event.categories.some(cat => cat.title.toLowerCase().includes('wildfire'))) {
                                category = 'wildfire';
                                type = 'Wildfire';
                            } else if (event.categories.some(cat => cat.title.toLowerCase().includes('flood'))) {
                                category = 'flood';
                                type = 'Flood';
                            } else if (event.categories.some(cat => cat.title.toLowerCase().includes('storm'))) {
                                category = 'hurricane';
                                type = 'Storm';
                            }
                            
                            return {
                                id: `nasa-${event.id}-${Math.random().toString(36).substr(2, 9)}`,
                                type: type,
                                name: event.title,
                                date: event.geometry[0].date.split('T')[0],
                                location: event.title,
                                severity: 'medium',
                                impact: `Natural event monitored by NASA satellites`,
                                category: category.toLowerCase(), // Ensure lowercase
                                lat: coords[1] || 0,
                                lng: coords[0] || 0,
                                source: 'NASA EONET',
                                timestamp: new Date(event.geometry[0].date).getTime()
                            };
                        });
                    
                    return events;
                }
            } catch (error) {
                console.error('NASA Events API error:', error);
            }
            return [];
        }

        // Helper functions for weather data processing
        function getWeatherIcon(iconCode) {
            const iconMap = {
                '01d': 'â˜€ï¸', '01n': 'ðŸŒ™',
                '02d': 'â›…', '02n': 'â˜ï¸',
                '03d': 'â˜ï¸', '03n': 'â˜ï¸',
                '04d': 'â˜ï¸', '04n': 'â˜ï¸',
                '09d': 'ðŸŒ§ï¸', '09n': 'ðŸŒ§ï¸',
                '10d': 'ðŸŒ¦ï¸', '10n': 'ðŸŒ§ï¸',
                '11d': 'â›ˆï¸', '11n': 'â›ˆï¸',
                '13d': 'â„ï¸', '13n': 'â„ï¸',
                '50d': 'ðŸŒ«ï¸', '50n': 'ðŸŒ«ï¸'
            };
            return iconMap[iconCode] || 'ðŸŒ¤ï¸';
        }

        function getWeatherIconFromCode(code) {
            if (code === 0) return 'â˜€ï¸';
            if (code <= 3) return 'â›…';
            if (code <= 48) return 'ðŸŒ«ï¸';
            if (code <= 67) return 'ðŸŒ§ï¸';
            if (code <= 77) return 'â„ï¸';
            if (code <= 82) return 'ðŸŒ¦ï¸';
            if (code <= 99) return 'â›ˆï¸';
            return 'ðŸŒ¤ï¸';
        }

        function getWeatherDescription(code) {
            const descriptions = {
                0: 'Clear sky',
                1: 'Mainly clear',
                2: 'Partly cloudy',
                3: 'Overcast',
                45: 'Fog',
                48: 'Depositing rime fog',
                51: 'Light drizzle',
                61: 'Slight rain',
                80: 'Slight rain showers',
                95: 'Thunderstorm'
            };
            return descriptions[code] || 'Unknown';
        }

        function getFallbackWeatherData(city) {
            const fallbackData = {
                'new york': { temp: 22, desc: 'Partly Cloudy', icon: 'â›…' },
                'london': { temp: 15, desc: 'Light Rain', icon: 'ðŸŒ§ï¸' },
                'tokyo': { temp: 28, desc: 'Sunny', icon: 'â˜€ï¸' },
                'paris': { temp: 18, desc: 'Cloudy', icon: 'â˜ï¸' },
                'sydney': { temp: 25, desc: 'Clear', icon: 'â˜€ï¸' }
            };
            
            const cityData = fallbackData[city.toLowerCase()] || fallbackData['new york'];
            
            return {
                temperature: `${cityData.temp}Â°C`,
                description: cityData.desc,
                location: city,
                icon: cityData.icon,
                humidity: '65%',
                windSpeed: '12 km/h',
                pressure: '1013 hPa',
                visibility: '10 km',
                timestamp: Date.now()
            };
        }

        let currentFilter = 'all';
        let currentUser = null;
        let isLoginMode = true;
        let disasterMap = null;
        let disasterMarkers = [];

        // Authentication functions
        function showLoginModal() {
            isLoginMode = true;
            document.getElementById('authTitle').textContent = 'Welcome Back';
            document.getElementById('authSubtitle').textContent = 'Sign in to your account';
            document.getElementById('authSubmit').textContent = 'Sign In';
            document.getElementById('authSwitchText').textContent = "Don't have an account?";
            document.getElementById('authSwitchLink').textContent = 'Sign up';
            document.getElementById('nameGroup').style.display = 'none';
            document.getElementById('authModal').classList.add('active');
        }

        function showSignupModal() {
            isLoginMode = false;
            document.getElementById('authTitle').textContent = 'Create Account';
            document.getElementById('authSubtitle').textContent = 'Join Terrascope today';
            document.getElementById('authSubmit').textContent = 'Sign Up';
            document.getElementById('authSwitchText').textContent = 'Already have an account?';
            document.getElementById('authSwitchLink').textContent = 'Sign in';
            document.getElementById('nameGroup').style.display = 'block';
            document.getElementById('authModal').classList.add('active');
        }

        function closeAuthModal() {
            document.getElementById('authModal').classList.remove('active');
            document.getElementById('authForm').reset();
        }

        function toggleAuthMode() {
            if (isLoginMode) {
                showSignupModal();
            } else {
                showLoginModal();
            }
        }

        function handleAuth(event) {
            event.preventDefault();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const fullName = document.getElementById('fullName').value;

            if (isLoginMode) {
                // Simulate login
                currentUser = {
                    name: email.split('@')[0],
                    email: email,
                    avatar: email.charAt(0).toUpperCase()
                };
                
                showSuccessMessage('Login successful! Welcome back.');
            } else {
                // Simulate signup
                if (!fullName) {
                    alert('Please enter your full name');
                    return;
                }
                
                currentUser = {
                    name: fullName,
                    email: email,
                    avatar: fullName.charAt(0).toUpperCase()
                };
                
                showSuccessMessage('Account created successfully! Welcome to Terrascope.');
            }

            updateAuthUI();
            closeAuthModal();
        }

        function updateAuthUI() {
            if (currentUser) {
                document.getElementById('authButtons').style.display = 'none';
                document.getElementById('userMenu').classList.add('active');
                document.getElementById('userAvatar').textContent = currentUser.avatar;
            } else {
                document.getElementById('authButtons').style.display = 'flex';
                document.getElementById('userMenu').classList.remove('active');
            }
        }

        function toggleUserDropdown() {
            const dropdown = document.getElementById('userDropdown');
            dropdown.classList.toggle('active');
        }

        function logout() {
            currentUser = null;
            updateAuthUI();
            document.getElementById('userDropdown').classList.remove('active');
            showSuccessMessage('Logged out successfully');
        }

        function showSuccessMessage(message) {
            // Create a temporary success message
            const successDiv = document.createElement('div');
            successDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #2ed573, #1dd1a1);
                color: white;
                padding: 15px 25px;
                border-radius: 10px;
                box-shadow: 0 5px 15px rgba(45, 213, 115, 0.3);
                z-index: 1001;
                animation: slideIn 0.3s ease-out;
            `;
            successDiv.textContent = message;
            document.body.appendChild(successDiv);
            
            setTimeout(() => {
                successDiv.remove();
            }, 3000);
        }

        // Google Authentication Handler - REAL IMPLEMENTATION
        function handleGoogleAuth() {
            // Show loading state
            const googleBtn = document.querySelector('.google-btn');
            const originalText = googleBtn.innerHTML;
            
            googleBtn.innerHTML = `
                <div style="width: 20px; height: 20px; border: 2px solid #4285F4; border-top: 2px solid transparent; border-radius: 50%; animation: spin 1s linear infinite; margin-right: 10px;"></div>
                <span>Connecting to Google...</span>
            `;
            googleBtn.disabled = true;
            
            // Check if Google Identity Services is loaded
            if (typeof google !== 'undefined' && google.accounts) {
                // Use Google Identity Services (new method)
                google.accounts.id.prompt((notification) => {
                    if (notification.isNotDisplayed() || notification.isSkippedMoment()) {
                        // Fallback to popup
                        google.accounts.oauth2.initTokenClient({
                            client_id: GOOGLE_CLIENT_ID,
                            scope: 'email profile',
                            callback: handleGoogleResponse
                        }).requestAccessToken();
                    }
                });
            } else {
                // Fallback: Direct OAuth URL method
                initiateGoogleOAuth();
            }
            
            // Reset button after timeout
            setTimeout(() => {
                googleBtn.innerHTML = originalText;
                googleBtn.disabled = false;
            }, 5000);
        }

        // Handle Google OAuth response
        function handleGoogleResponse(response) {
            if (response.access_token) {
                // Get user info from Google
                fetch('https://www.googleapis.com/oauth2/v2/userinfo', {
                    headers: {
                        'Authorization': `Bearer ${response.access_token}`
                    }
                })
                .then(response => response.json())
                .then(userInfo => {
                    currentUser = {
                        name: userInfo.name,
                        email: userInfo.email,
                        avatar: userInfo.name.charAt(0).toUpperCase(),
                        provider: 'google',
                        picture: userInfo.picture,
                        googleId: userInfo.id
                    };
                    
                    updateAuthUI();
                    closeAuthModal();
                    showSuccessMessage(`Welcome ${userInfo.name}! Signed in with Google.`);
                })
                .catch(error => {
                    console.error('Error fetching user info:', error);
                    showErrorMessage('Failed to get user information from Google');
                });
            } else if (response.credential) {
                // Handle JWT credential (Google Identity Services)
                const userInfo = parseJWT(response.credential);
                currentUser = {
                    name: userInfo.name,
                    email: userInfo.email,
                    avatar: userInfo.name.charAt(0).toUpperCase(),
                    provider: 'google',
                    picture: userInfo.picture,
                    googleId: userInfo.sub
                };
                
                updateAuthUI();
                closeAuthModal();
                showSuccessMessage(`Welcome ${userInfo.name}! Signed in with Google.`);
            }
        }

        // Parse JWT token (for Google Identity Services)
        function parseJWT(token) {
            const base64Url = token.split('.')[1];
            const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));
            return JSON.parse(jsonPayload);
        }

        // Direct OAuth URL method (fallback)
        function initiateGoogleOAuth() {
            const params = new URLSearchParams({
                client_id: GOOGLE_CLIENT_ID,
                redirect_uri: window.location.origin + window.location.pathname,
                response_type: 'code',
                scope: 'email profile',
                access_type: 'offline',
                prompt: 'consent'
            });
            
            const authUrl = `https://accounts.google.com/oauth/authorize?${params.toString()}`;
            
            // Open in popup window
            const popup = window.open(authUrl, 'google-auth', 'width=500,height=600,scrollbars=yes,resizable=yes');
            
            // Monitor popup
            const checkClosed = setInterval(() => {
                if (popup.closed) {
                    clearInterval(checkClosed);
                    // Check if we received auth code in URL
                    checkForAuthCode();
                }
            }, 1000);
        }

        // Check for authorization code in URL
        function checkForAuthCode() {
            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get('code');
            
            if (code) {
                // Exchange code for access token
                exchangeCodeForToken(code);
                
                // Clean up URL
                window.history.replaceState({}, document.title, window.location.pathname);
            }
        }

        // Exchange authorization code for access token
        async function exchangeCodeForToken(code) {
            try {
                // Note: In production, this should be done on your backend server
                // This is a simplified example - you'll need a backend endpoint
                const response = await fetch('https://oauth2.googleapis.com/token', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams({
                        client_id: GOOGLE_CLIENT_ID,
                        client_secret: GOOGLE_CLIENT_SECRET, // Should be on backend only!
                        code: code,
                        grant_type: 'authorization_code',
                        redirect_uri: window.location.origin + window.location.pathname
                    })
                });
                
                const tokenData = await response.json();
                
                if (tokenData.access_token) {
                    handleGoogleResponse({ access_token: tokenData.access_token });
                }
            } catch (error) {
                console.error('Token exchange error:', error);
                showErrorMessage('Authentication failed. Please try again.');
            }
        }

        // Show error message
        function showErrorMessage(message) {
            const errorDiv = document.createElement('div');
            errorDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #e74c3c, #c0392b);
                color: white;
                padding: 15px 25px;
                border-radius: 10px;
                box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3);
                z-index: 1001;
                animation: slideIn 0.3s ease-out;
            `;
            errorDiv.textContent = message;
            document.body.appendChild(errorDiv);
            
            setTimeout(() => {
                errorDiv.remove();
            }, 5000);
        }

        // Navigation functions
        function showLaunchPage() {
            document.getElementById('launchPage').style.display = 'block';
            document.getElementById('weatherPage').classList.remove('active');
            document.getElementById('disasterPage').classList.remove('active');
        }

        function showWeatherPage() {
            document.getElementById('launchPage').style.display = 'none';
            document.getElementById('weatherPage').classList.add('active');
            document.getElementById('disasterPage').classList.remove('active');
            
            // Load current location weather and Pakistan cities
            getCurrentLocationWeather();
            loadPakistanCitiesWeather();
        }

        function showDisasterPage() {
            document.getElementById('launchPage').style.display = 'none';
            document.getElementById('weatherPage').classList.remove('active');
            document.getElementById('disasterPage').classList.add('active');
            renderDisasters();
            
            // Initialize map after a short delay to ensure the container is visible
            setTimeout(() => {
                initializeMap();
            }, 100);
            
            // Start real-time updates when entering disaster page
            startRealTimeUpdates();
        }

        function showComingSoon(feature) {
            alert(`${feature} is coming soon! Stay tuned for updates.`);
        }

        // Real-time data update functions
        async function updateRealTimeData() {
            try {
                // Update disasters from multiple sources
                const [earthquakes, nasaEvents] = await Promise.all([
                    fetchRealEarthquakes(),
                    fetchNASAEvents()
                ]);
                
                // Combine all disaster data
                disasters = [...earthquakes, ...nasaEvents];
                
                // Update UI if on disaster page
                if (document.getElementById('disasterPage').classList.contains('active')) {
                    renderDisasters();
                    renderDisasterMarkers();
                }
                
                // Show update notification
                showUpdateNotification(`Updated: ${disasters.length} events loaded`);
                
            } catch (error) {
                console.error('Real-time update error:', error);
                showUpdateNotification('Update failed - using cached data', 'error');
            }
        }

        // Get user's current location weather
        async function getCurrentLocationWeather() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(async (position) => {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    
                    try {
                        const weather = await fetchWeatherByCoords(lat, lng);
                        updateCurrentLocationUI(weather);
                    } catch (error) {
                        console.error('Current location weather error:', error);
                        document.getElementById('currentDesc').textContent = 'Location weather unavailable';
                        document.getElementById('currentIcon').textContent = 'âŒ';
                    }
                }, (error) => {
                    console.error('Geolocation error:', error);
                    document.getElementById('currentDesc').textContent = 'Location access denied';
                    document.getElementById('currentIcon').textContent = 'ðŸ“';
                });
            } else {
                document.getElementById('currentDesc').textContent = 'Geolocation not supported';
                document.getElementById('currentIcon').textContent = 'âŒ';
            }
        }

        // Fetch weather by coordinates
        async function fetchWeatherByCoords(lat, lng) {
            try {
                if (API_CONFIG.WEATHER_API_KEY !== '6ffc9e5dba1cdec95600aa9e0106c72f') {
                    const response = await fetch(
                        `${API_CONFIG.WEATHER_BASE_URL}?lat=${lat}&lon=${lng}&appid=${API_CONFIG.WEATHER_API_KEY}&units=metric`
                    );
                    
                    if (response.ok) {
                        const data = await response.json();
                        return {
                            temperature: `${Math.round(data.main.temp)}Â°C`,
                            description: data.weather[0].description,
                            location: `${data.name}, ${data.sys.country}`,
                            icon: getWeatherIcon(data.weather[0].icon),
                            humidity: `${data.main.humidity}%`,
                            windSpeed: `${Math.round(data.wind.speed * 3.6)} km/h`,
                            pressure: `${data.main.pressure} hPa`,
                            visibility: `${Math.round(data.visibility / 1000)} km`
                        };
                    }
                }

                // Fallback to Open-Meteo
                const weatherResponse = await fetch(
                    `${API_CONFIG.BACKUP_WEATHER_URL}?latitude=${lat}&longitude=${lng}&current_weather=true&hourly=relative_humidity_2m,surface_pressure,visibility`
                );
                
                if (weatherResponse.ok) {
                    const weatherData = await weatherResponse.json();
                    const current = weatherData.current_weather;
                    
                    return {
                        temperature: `${Math.round(current.temperature)}Â°C`,
                        description: getWeatherDescription(current.weathercode),
                        location: 'Your Location',
                        icon: getWeatherIconFromCode(current.weathercode),
                        humidity: `${weatherData.hourly.relative_humidity_2m[0] || 'N/A'}%`,
                        windSpeed: `${Math.round(current.windspeed)} km/h`,
                        pressure: `${Math.round(weatherData.hourly.surface_pressure[0] || 1013)} hPa`,
                        visibility: `${Math.round((weatherData.hourly.visibility[0] || 10000) / 1000)} km`
                    };
                }
            } catch (error) {
                console.error('Weather by coords error:', error);
            }
            
            return getFallbackWeatherData('Your Location');
        }

        // Update current location UI
        function updateCurrentLocationUI(weather) {
            document.getElementById('currentTemp').textContent = weather.temperature;
            document.getElementById('currentDesc').textContent = weather.description;
            document.getElementById('currentLocation').textContent = `ðŸ“ ${weather.location}`;
            document.getElementById('currentIcon').textContent = weather.icon;
            document.getElementById('currentHumidity').textContent = weather.humidity;
            document.getElementById('currentWind').textContent = weather.windSpeed;
            document.getElementById('currentPressure').textContent = weather.pressure;
            document.getElementById('currentVisibility').textContent = weather.visibility;
        }

        // Enhanced weather function for search
        async function updateWeather() {
            const locationInput = document.getElementById('locationInput');
            const city = locationInput.value.trim();
            
            if (!city) return;
            
            // Show loading state
            const searchCard = document.getElementById('searchWeatherCard');
            searchCard.style.display = 'block';
            searchCard.style.opacity = '0.7';
            
            try {
                const weather = await fetchRealWeather(city);
                
                document.getElementById('searchTemp').textContent = weather.temperature;
                document.getElementById('searchDesc').textContent = weather.description;
                document.getElementById('searchLocation').textContent = weather.location;
                document.getElementById('searchIcon').textContent = weather.icon;
                document.getElementById('searchHumidity').textContent = weather.humidity;
                document.getElementById('searchWind').textContent = weather.windSpeed;
                document.getElementById('searchPressure').textContent = weather.pressure;
                document.getElementById('searchVisibility').textContent = weather.visibility;
                
                // Animation
                searchCard.style.transform = 'scale(0.95)';
                searchCard.style.opacity = '1';
                setTimeout(() => {
                    searchCard.style.transform = 'scale(1)';
                }, 150);
                
                showUpdateNotification(`Weather updated for ${weather.location}`);
                
            } catch (error) {
                console.error('Weather update error:', error);
                searchCard.style.opacity = '1';
                showUpdateNotification('Weather update failed', 'error');
            }
        }

        // Load weather for Pakistan cities
        async function loadCityWeather(cityName) {
            try {
                const weather = await fetchRealWeather(cityName);
                const cityId = cityName.toLowerCase();
                
                document.getElementById(`${cityId}-weather`).textContent = weather.description;
                document.getElementById(`${cityId}-temp`).textContent = weather.temperature;
                
                // Fill search with this city
                document.getElementById('locationInput').value = cityName;
                updateWeather();
                
            } catch (error) {
                console.error(`Error loading ${cityName} weather:`, error);
                const cityId = cityName.toLowerCase();
                document.getElementById(`${cityId}-weather`).textContent = 'Error loading';
                document.getElementById(`${cityId}-temp`).textContent = '--Â°C';
            }
        }

        // Load all Pakistan cities weather
        async function loadPakistanCitiesWeather() {
            const cities = ['Karachi', 'Lahore', 'Islamabad', 'Faisalabad', 'Peshawar'];
            
            for (const city of cities) {
                try {
                    const weather = await fetchRealWeather(city);
                    const cityId = city.toLowerCase();
                    
                    document.getElementById(`${cityId}-weather`).textContent = weather.description;
                    document.getElementById(`${cityId}-temp`).textContent = weather.temperature;
                } catch (error) {
                    console.error(`Error loading ${city} weather:`, error);
                    const cityId = city.toLowerCase();
                    document.getElementById(`${cityId}-weather`).textContent = 'Error';
                    document.getElementById(`${cityId}-temp`).textContent = '--Â°C';
                }
                
                // Small delay between requests to avoid rate limiting
                await new Promise(resolve => setTimeout(resolve, 200));
            }
        }

        // Auto-refresh functions
        function startRealTimeUpdates() {
            // Clear existing intervals
            updateIntervals.forEach(interval => clearInterval(interval));
            updateIntervals = [];
            
            // Update disasters every 5 minutes
            const disasterInterval = setInterval(updateRealTimeData, 300000);
            updateIntervals.push(disasterInterval);
            
            // Update weather every 10 minutes for current location
            const weatherInterval = setInterval(() => {
                const currentLocation = document.getElementById('locationInput').value;
                if (currentLocation && document.getElementById('weatherPage').classList.contains('active')) {
                    updateWeather();
                }
            }, 600000);
            updateIntervals.push(weatherInterval);
            
            // Initial load
            updateRealTimeData();
        }

        function stopRealTimeUpdates() {
            updateIntervals.forEach(interval => clearInterval(interval));
            updateIntervals = [];
        }

        // Update notification system
        function showUpdateNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 80px;
                right: 20px;
                background: ${type === 'error' ? 'linear-gradient(135deg, #e74c3c, #c0392b)' : 'linear-gradient(135deg, #2ed573, #1dd1a1)'};
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                z-index: 1001;
                font-size: 0.9rem;
                max-width: 300px;
                animation: slideInRight 0.3s ease-out;
                backdrop-filter: blur(10px);
            `;
            
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 8px;">
                    <span>${type === 'error' ? 'âš ï¸' : 'ðŸ”„'}</span>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease-out';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Add CSS for notification animations
        const notificationStyles = document.createElement('style');
        notificationStyles.textContent = `
            @keyframes slideInRight {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
            
            @keyframes slideOutRight {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(100%);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(notificationStyles);

        // Switch disaster tab function
        function switchDisasterTab(tabType) {
            // Clear animations when switching tabs
            clearMapAnimations();
            
            // Update tab states
            document.querySelectorAll('.disaster-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            const activeTab = document.querySelector(`[data-tab="${tabType}"]`);
            if (activeTab) {
                activeTab.classList.add('active');
            }
            
            // Update current filter and render
            currentFilter = tabType;
            renderDisasters();
            
            // Clear map selection when switching tabs
            selectedEvent = null;
            resetMapView();
        }

        // Enhanced disaster rendering
        function renderDisasters() {
            const disasterList = document.getElementById('disasterList');
            const filteredDisasters = currentFilter === 'all' 
                ? disasters 
                : disasters.filter(d => d.category === currentFilter);

            if (filteredDisasters.length === 0) {
                disasterList.innerHTML = `
                    <div class="loading-state">
                        <div style="font-size: 2rem; margin-bottom: 16px;">ðŸ”</div>
                        <p>No disasters found matching your criteria</p>
                    </div>
                `;
                return;
            }

            disasterList.innerHTML = filteredDisasters.map(disaster => `
                <div class="disaster-event ${disaster.category} severity-${disaster.severity}" 
                     data-event-id="${disaster.id}" 
                     onclick="selectDisasterEvent('${disaster.id}')">
                    <div class="event-header">
                        <div class="event-title">${disaster.name}</div>
                        <div class="event-severity severity-${disaster.severity}">
                            ${disaster.severity.toUpperCase()}
                        </div>
                    </div>
                    <div class="event-details">
                        <div class="event-location">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                                <circle cx="12" cy="10" r="3"/>
                            </svg>
                            ${disaster.location}
                        </div>
                        <div class="event-date">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                                <line x1="16" y1="2" x2="16" y2="6"/>
                                <line x1="8" y1="2" x2="8" y2="6"/>
                                <line x1="3" y1="10" x2="21" y2="10"/>
                            </svg>
                            ${new Date(disaster.date).toLocaleDateString('en-US', { 
                                year: 'numeric', 
                                month: 'short', 
                                day: 'numeric' 
                            })}
                        </div>
                        ${disaster.magnitude ? `
                            <div class="event-magnitude">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                                </svg>
                                ${disaster.magnitude}
                            </div>
                        ` : ''}
                    </div>
                </div>
            `).join('');
            
            // Update events count
            document.getElementById('eventsCount').textContent = filteredDisasters.length;
        }

        function filterDisasters(category) {
            // Clear animations when filtering
            clearMapAnimations();
            
            // Update both filter buttons and tabs
            currentFilter = category;
            
            // Update filter button states
            document.querySelectorAll('.type-filter').forEach(btn => {
                btn.classList.remove('active');
            });
            
            const activeButton = document.querySelector(`[data-type="${category}"]`);
            if (activeButton) {
                activeButton.classList.add('active');
            }
            
            // Update tab states
            document.querySelectorAll('.disaster-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            const activeTab = document.querySelector(`[data-tab="${category}"]`);
            if (activeTab) {
                activeTab.classList.add('active');
            }
            
            renderDisasters();
            renderDisasterMarkers();
            updateStatistics();
            
            // Clear map selection when filtering
            selectedEvent = null;
            resetMapView();
        }

        // Map rendering functions
        function initializeMap() {
            if (disasterMap) {
                disasterMap.remove();
            }
            
            disasterMap = L.map('disasterMap').setView([20, 0], 2);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: 'Â© OpenStreetMap contributors',
                maxZoom: 18
            }).addTo(disasterMap);
            
            renderDisasterMarkers();
        }

        function renderDisasterMarkers() {
            if (!disasterMap) return;
            
            // Clear existing markers - don't show any markers by default
            disasterMarkers.forEach(marker => disasterMap.removeLayer(marker));
            disasterMarkers = [];
            
            // Only show markers when a specific event is selected
            // The map will be clean by default until user selects an event
        }

        function getDisasterColor(category) {
            const colors = {
                'earthquake': '#ff4757',
                'hurricane': '#3742fa',
                'flood': '#2ed573',
                'wildfire': '#ffa502'
            };
            return colors[category] || '#ff4757';
        }

        function getDisasterIcon(category) {
            const icons = {
                'earthquake': 'ðŸŒ',
                'hurricane': 'ðŸŒ€',
                'flood': 'ðŸŒŠ',
                'wildfire': 'ðŸ”¥'
            };
            return icons[category] || 'âš ï¸';
        }

        // Event listeners
        document.getElementById('locationInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                updateWeather();
            }
        });

        // Close modal when clicking outside
        document.getElementById('authModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeAuthModal();
            }
        });

        // Close user dropdown when clicking outside
        document.addEventListener('click', function(e) {
            const userMenu = document.getElementById('userMenu');
            const dropdown = document.getElementById('userDropdown');
            
            if (!userMenu.contains(e.target)) {
                dropdown.classList.remove('active');
            }
        });

        // Initialize Google Sign-In
        function initializeGoogleSignIn() {
            if (typeof google !== 'undefined' && google.accounts) {
                google.accounts.id.initialize({
                    client_id: GOOGLE_CLIENT_ID,
                    callback: handleGoogleResponse,
                    auto_select: false,
                    cancel_on_tap_outside: true
                });
                
                // Render the Google Sign-In button (optional - we're using custom button)
                // google.accounts.id.renderButton(
                //     document.getElementById('google-signin-button'),
                //     { theme: 'outline', size: 'large' }
                // );
                
                console.log('Google Sign-In initialized successfully');
            } else {
                console.warn('Google Identity Services not loaded');
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeSpaceBackground();
            generateHistoricalData();
            showLaunchPage();
            updateAuthUI();
            
            // Initialize with recent data
            disasters = historicalDisasters.slice(0, 50); // Show last 50 events by default
            
            // Setup search functionality
            setupRealTimeSearch();
            
            // Initialize Google Sign-In after a short delay to ensure script is loaded
            setTimeout(initializeGoogleSignIn, 1000);
        });
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98f5c46866f5d055',t:'MTc2MDU5ODk0OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>